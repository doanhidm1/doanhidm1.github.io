# タグリファレンス

KAG で使用可能なタグのリファレンスです。

# タグの概要

タグは、[ ] の間に囲まれたものです。基本的に半角英数小文字で記述します。
　[ の次にすぐにタグ名を書きます。たとえば、trans
というタグであれば [trans となります。
　タグには、タグのオプションを指定するために属性というものがあります。なにも属性を指定しなくていい場合は、タグ名のあとに ] を書いてタグは終わりです。たとえば
[ct]
となります。
　属性を指定する場合は、タグ名のあとや、前の属性のあとには必ず半角スペースを空けて、属性名を書きます。属性名の後には
= を書き、その後に属性の値を書きます。すべての属性を書いたら ]
でタグを閉じます。
　たとえば、trans タグに time という属性を書きたい場合は、[trans time=0] とします。また、さらに rule=trans vague=1 という属性を書きたい場合は
[trans time=0 rule=trans vague=1] とします。
　属性の値は "" で囲んでも囲まなくても同じです。たとえば、[trans time="0"]と [trans time=0]
は同じです。ただし、属性の値に空白を含むような場合は、"" で囲まなければなりません。たとえば、[font face="ＭＳ Ｐゴシック"] です。
　また、属性の値に対し、& を最初につけると、その後に書いたものを
TJS 式として評価し、その結果を属性の値とします。たとえば、[trans time=&f.clearTime] とすると、f.clearTime という変数の内容が、time
属性の値となります。
　属性の値を省略すると (属性のうち '=' 以降を書かないと)、true という属性の値が指定されたと見なされます。たとえば、[playse loop storage="shock.wav"] は、loop 属性の値が省略されていますが、これは [playse loop=true storage="shock.wav"] と同じ意味になります。

# コマンド行

コマンド行は、@ で始まり、その次にタグ名と属性を記述するものです。
　一つの行には一つのタグのみを書くことができます。
　以下の二つの行は等価になります。

[trans time=0 rule=trans vague=1]
@trans time=0 rule=trans vague=1

# cond 属性

macro endmacro if else elsif endif ignore endignore iscript endscript のタグをのぞき、すべてのタグに cond 属性があります。
　cond 属性には TJS式 を指定し、この式を評価した結果が真の時のみにそのタグが実行されます。偽の時はタグは実行されません。

例 :

[l cond=f.noskip]
; ↑ f.noskip が真の時のみ l タグを実行

# ジャンル・タグ一覧

システム操作

|  |  |
| --- | --- |
| [autowc](#autowc) | ( 自動ウェイト ) |
| [clearsysvar](#clearsysvar) | ( システム変数の全消去 ) |
| [clickskip](#clickskip) | ( クリックスキップの設定 ) |
| [close](#close) | ( ウィンドウを閉じる ) |
| [cursor](#cursor) | ( マウスカーソルの変更 ) |
| [hidemessage](#hidemessage) | ( メッセージを消す ) |
| [loadplugin](#loadplugin) | ( プラグインの読み込み ) |
| [mappfont](#mappfont) | ( レンダリング済みフォントの割り当て ) |
| [nextskip](#nextskip) | ( 「次の選択肢まですすむ」の設定 ) |
| [quake](#quake) | ( 画面を揺らす ) |
| [rclick](#rclick) | ( 右クリックの設定 ) |
| [resetwait](#resetwait) | ( ウェイトの初期化 ) |
| [s](#s) | ( 停止する ) |
| [stopquake](#stopquake) | ( 画面揺らしの停止 ) |
| [title](#title) | ( タイトル指定 ) |
| [wait](#wait) | ( ウェイトを入れる ) |
| [waitclick](#waitclick) | ( クリックを待つ ) |
| [wc](#wc) | ( 文字数分のウェイトを入れる ) |
| [wq](#wq) | ( 画面揺らしの終了待ち ) |

フォーム操作

|  |  |
| --- | --- |
| [checkbox](#checkbox) | ( チェックボックスの作成 ) |
| [commit](#commit) | ( フォーム内容の確定 ) |
| [edit](#edit) | ( 単一行エディットの作成 ) |

マクロ操作

|  |  |
| --- | --- |
| [endmacro](#endmacro) | ( マクロの記述(の終了) ) |
| [erasemacro](#erasemacro) | ( マクロの消去 ) |
| [macro](#macro) | ( マクロの記述 ) |

メッセージ操作

|  |  |
| --- | --- |
| [cancelautomode](#cancelautomode) | ( 「自動的に読み進む」の解除 ) |
| [cancelskip](#cancelskip) | ( スキップの解除 ) |
| [ch](#ch) | ( 文字を表示する ) |
| [cm](#cm) | ( すべてのメッセージレイヤのクリア ) |
| [ct](#ct) | ( メッセージレイヤのリセット ) |
| [current](#current) | ( 操作対象のメッセージレイヤの指定 ) |
| [deffont](#deffont) | ( デフォルトの文字属性設定 ) |
| [defstyle](#defstyle) | ( デフォルトのスタイルの設定 ) |
| [delay](#delay) | ( 文字の表示速度の設定 ) |
| [endindent](#endindent) | ( インデントの解除 ) |
| [endnowait](#endnowait) | ( 文字表示ノーウェイト(の終了) ) |
| [er](#er) | ( メッセージレイヤの文字の消去 ) |
| [font](#font) | ( 文字属性設定 ) |
| [glyph](#glyph) | ( クリック待ち記号の指定 ) |
| [graph](#graph) | ( インライン画像表示 ) |
| [hch](#hch) | ( 縦中横を表示する ) |
| [indent](#indent) | ( インデントの設定 ) |
| [l](#l) | ( 行末クリック待ち ) |
| [locate](#locate) | ( 文字表示位置の指定 ) |
| [locklink](#locklink) | ( リンクのロック ) |
| [nowait](#nowait) | ( 文字表示ノーウェイト ) |
| [p](#p) | ( 改ページクリック待ち ) |
| [position](#position) | ( メッセージレイヤの属性 ) |
| [r](#r) | ( 改行する ) |
| [resetfont](#resetfont) | ( 文字属性をデフォルトに戻す ) |
| [resetstyle](#resetstyle) | ( スタイルをデフォルトに戻す ) |
| [ruby](#ruby) | ( ルビ指定 ) |
| [style](#style) | ( スタイルの設定 ) |
| [unlocklink](#unlocklink) | ( リンクのロックの解除 ) |

メッセージ履歴操作

|  |  |
| --- | --- |
| [endhact](#endhact) | ( メッセージ履歴アクションの終了 ) |
| [hact](#hact) | ( メッセージ履歴アクション ) |
| [history](#history) | ( メッセージ履歴の設定 ) |
| [hr](#hr) | ( メッセージ履歴の改行/改ページ ) |
| [showhistory](#showhistory) | ( メッセージ履歴の表示 ) |

ラベル・ジャンプ操作

|  |  |
| --- | --- |
| [button](#button) | ( グラフィカルボタン ) |
| [call](#call) | ( サブルーチンの呼び出し ) |
| [cclick](#cclick) | ( クリック待ち解除 ) |
| [click](#click) | ( クリック待ちジャンプ ) |
| [ctimeout](#ctimeout) | ( タイムアウト待ち解除 ) |
| [cwheel](#cwheel) | ( ホイール待ち解除 ) |
| [endlink](#endlink) | ( ハイパーリンク(の終了) ) |
| [jump](#jump) | ( シナリオのジャンプ ) |
| [link](#link) | ( ハイパーリンク ) |
| [return](#return) | ( サブルーチンから戻る ) |
| [timeout](#timeout) | ( タイムアウト待ちジャンプ ) |
| [wheel](#wheel) | ( ホイール待ちジャンプ ) |

レイヤ操作

|  |  |
| --- | --- |
| [animstart](#animstart) | ( アニメーションの開始 ) |
| [animstop](#animstop) | ( アニメーションの停止 ) |
| [backlay](#backlay) | ( レイヤ情報の表ページから裏ページへのコピー ) |
| [copylay](#copylay) | ( レイヤ情報のコピー ) |
| [freeimage](#freeimage) | ( レイヤ画像の解放 ) |
| [image](#image) | ( 画像の読み込み ) |
| [laycount](#laycount) | ( レイヤの数の変更 ) |
| [layopt](#layopt) | ( レイヤの属性 ) |
| [mapaction](#mapaction) | ( クリッカブルマップ用領域アクション定義ファイルの指定 ) |
| [mapdisable](#mapdisable) | ( クリッカブルマップの無効化 ) |
| [mapimage](#mapimage) | ( クリッカブルマップ用領域画像の指定 ) |
| [move](#move) | ( レイヤの自動移動 ) |
| [pimage](#pimage) | ( 画像の部分追加読み込み ) |
| [ptext](#ptext) | ( レイヤへの文字描画 ) |
| [stopmove](#stopmove) | ( レイヤの自動移動の停止 ) |
| [stoptrans](#stoptrans) | ( レイヤのトランジションの停止 ) |
| [trans](#trans) | ( レイヤのトランジション ) |
| [wa](#wa) | ( アニメーションの停止待ち ) |
| [wm](#wm) | ( 自動移動の終了待ち ) |
| [wt](#wt) | ( トランジションの終了待ち ) |

効果音・BGM・ビデオ操作

|  |  |
| --- | --- |
| [bgmopt](#bgmopt) | ( BGM の設定 ) |
| [cancelvideoevent](#cancelvideoevent) | ( ピリオドイベントの解除 ) |
| [cancelvideosegloop](#cancelvideosegloop) | ( ビデオのセグメントループ再生の解除 ) |
| [clearbgmlabel](#clearbgmlabel) | ( BGM のラベル通過処理の解除 ) |
| [clearbgmstop](#clearbgmstop) | ( BGM の停止処理の解除 ) |
| [clearvideolayer](#clearvideolayer) | ( ビデオレイヤ解除 ) |
| [fadebgm](#fadebgm) | ( BGMのフェード ) |
| [fadeinbgm](#fadeinbgm) | ( フェードインしながらのBGM再生開始 ) |
| [fadeinse](#fadeinse) | ( 効果音のフェードイン再生 ) |
| [fadeoutbgm](#fadeoutbgm) | ( BGMのフェードアウト ) |
| [fadeoutse](#fadeoutse) | ( 効果音のフェードアウト ) |
| [fadepausebgm](#fadepausebgm) | ( BGM 演奏のフェードアウトしながらの一時停止 ) |
| [fadese](#fadese) | ( 効果音のフェード ) |
| [openvideo](#openvideo) | ( ビデオ/SWFの再生準備 ) |
| [pausebgm](#pausebgm) | ( BGM 演奏の一時停止 ) |
| [pausevideo](#pausevideo) | ( ビデオの一時停止 ) |
| [playbgm](#playbgm) | ( BGM の演奏 ) |
| [playse](#playse) | ( 効果音の再生 ) |
| [playvideo](#playvideo) | ( ビデオ/SWFの再生 ) |
| [preparevideo](#preparevideo) | ( ビデオの再生準備 ) |
| [resumebgm](#resumebgm) | ( BGM 演奏の再開 ) |
| [resumevideo](#resumevideo) | ( ビデオ再生の再開 ) |
| [rewindvideo](#rewindvideo) | ( ビデオの巻き戻し ) |
| [seopt](#seopt) | ( 効果音の設定 ) |
| [setbgmlabel](#setbgmlabel) | ( BGM のラベル通過処理の登録 ) |
| [setbgmstop](#setbgmstop) | ( BGM の停止処理の登録 ) |
| [stopbgm](#stopbgm) | ( BGM 演奏の停止 ) |
| [stopse](#stopse) | ( 効果音再生の停止 ) |
| [stopvideo](#stopvideo) | ( ビデオ/SWF再生の停止 ) |
| [video](#video) | ( ビデオ/SWF表示領域の属性を指定 ) |
| [videoevent](#videoevent) | ( ピリオドイベントの発生 ) |
| [videolayer](#videolayer) | ( ビデオレイヤ設定 ) |
| [videosegloop](#videosegloop) | ( ビデオのセグメントループ再生 ) |
| [wb](#wb) | ( BGM フェードの終了待ち ) |
| [wf](#wf) | ( 効果音フェードの終了待ち ) |
| [wl](#wl) | ( BGM 再生の終了待ち ) |
| [wp](#wp) | ( ビデオピリオドイベント待ち ) |
| [ws](#ws) | ( 効果音再生の終了待ち ) |
| [wv](#wv) | ( ビデオ再生の終了待ち ) |
| [xchgbgm](#xchgbgm) | ( BGM を入れ替える ) |

変数・TJS 操作

|  |  |
| --- | --- |
| [clearvar](#clearvar) | ( ゲーム変数の全消去 ) |
| [else](#else) | ( if の中身が実行されなかったときに実行 ) |
| [elsif](#elsif) | ( それまでの if の中身が実行されていなかったときに、条件付きで実行 ) |
| [emb](#emb) | ( 式評価結果の埋め込み ) |
| [endif](#endif) | ( 条件によりシナリオを実行(の終了) ) |
| [endignore](#endignore) | ( 条件によりシナリオを無視(の終了) ) |
| [endscript](#endscript) | ( TJS スクリプトの記述(の終了) ) |
| [eval](#eval) | ( 式の評価 ) |
| [if](#if) | ( 条件によりシナリオを実行 ) |
| [ignore](#ignore) | ( 条件によりシナリオを無視 ) |
| [input](#input) | ( 文字列の入力 ) |
| [iscript](#iscript) | ( TJS スクリプトの記述 ) |
| [trace](#trace) | ( コンソールへ値の出力 ) |
| [waittrig](#waittrig) | ( トリガを待つ ) |

栞・通過記録操作

|  |  |
| --- | --- |
| [copybookmark](#copybookmark) | ( 栞のコピー ) |
| [disablestore](#disablestore) | ( 栞の機能の一時的な使用不可 ) |
| [erasebookmark](#erasebookmark) | ( 栞の消去 ) |
| [goback](#goback) | ( 前に戻る ) |
| [gotostart](#gotostart) | ( 最初に戻る ) |
| [load](#load) | ( 栞の読み込み ) |
| [locksnapshot](#locksnapshot) | ( スナップショットのロック ) |
| [record](#record) | ( 通過記録を行う ) |
| [save](#save) | ( 栞の保存 ) |
| [startanchor](#startanchor) | ( 「最初に戻る」の有効・無効 ) |
| [store](#store) | ( 栞機能の設定 ) |
| [tempload](#tempload) | ( 栞のメモリ上からの読み込み ) |
| [tempsave](#tempsave) | ( 栞のメモリ上への保存 ) |
| [unlocksnapshot](#unlocksnapshot) | ( スナップショットのロックの解除 ) |

# animstart ( アニメーションの開始 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | アニメーションを開始するレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 　指定したレイヤには、アニメーション情報が読み込まれていないとなりません。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| seg | yes | 1 以上の整数 | この属性で指定したセグメント番号でアニメーションを開始します。  　異なるセグメント番号では同時に複数のアニメーションを実行できます。  　セグメント番号は任意の番号を指定できますが、必要以上に大きな番号を 指定しないでください。また、セグメント 0 は指定できません。 |
| target | yes | 開始ラベル名 | アニメーションを開始するための asd ファイル中のラベルを 指定します。  　[link](#link)タグなどと同じように、 \* (アステリスク) を忘れないようにしてください。 |

アニメーションを、指定したセグメントで、指定したラベルから開始します。
　セグメントは、一つのレイヤ、一つのアニメーション定義ファイル ( asd ファイル ) で
複数のアニメーションを同時に実行するための概念で、一つのレイヤで複数のセグメントを
使用でき、各セグメントで同時に別々のラベルからアニメーションを開始することができます。
　セグメント 0 は特別なセグメントで、レイヤに画像が読み込まれたのと同時に実行される
アニメーションで、このタグや [animstop](#animstop) タグではセグメント 0 は
指定できません。

[ジャンル・タグ一覧に戻る](#genre)

# animstop ( アニメーションの停止 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | アニメーションを停止するレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 　指定したレイヤには、アニメーション情報が読み込まれていないとなりません。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| seg | yes | 1 以上の整数 | この属性で指定したセグメント番号のアニメーションを停止します。  　セグメント番号 0 は指定できません。 |

任意のセグメントのアニメーションを停止します。
　このタグはアニメーションの終了を待ちません。アニメーションの終了を待つには
[wa](#wa) タグを使用してください。
　アニメーションがループしている場合、asd ファイル上で home タグを通過するまで
アニメーションは停止しません。

[ジャンル・タグ一覧に戻る](#genre)

# autowc ( 自動ウェイト )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| enabled | no | true または false | 自動ウェイトを有効にする場合は true を、無効にするには false を指定します。  　省略すれば設定は変更されません。 |
| ch | no | 対象の文字 | 自動ウェイトを入れる文字を指定します。指定された文字のあとに、time 属性で 指定した文字数分のウェイトが入ります。  　省略すれば設定は変更されません。 |
| time | no | ウェイト(文字数単位) | 自動ウェイトを入れる時間を文字数単位で指定します。  　ch 属性で指定した文字それぞれに対して、カンマで区切って時間を指定できます。  　一つしか時間を指定しなかった場合は ch タグで指定したすべての文字にその時間が 設定されます。  　この属性を省略した場合は 4 を指定したと見なされます。 |

特定の文字の後に指定文字数分のウェイトを入れることができます。
　ch 属性で指定した文字が表示された後、time 属性で指定した時間がウェイトとして入ります。
　文字は ch タグで複数指定できて、それに対応してそれぞれの文字に time 属性でタイミングを
指定できます。

`例:
[autowc enabled=true ch="、。・" time="3,5,3"]
; ↑ "、。・" の各文字に対してそれぞれ 3, 5, 3 文字数分のウェイトを入れる`

[ジャンル・タグ一覧に戻る](#genre)

# backlay ( レイヤ情報の表ページから裏ページへのコピー )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | no | "base" または 0 以上の整数 また は message0 または message1 または message | 対象となるレイヤを指定します。  　base を指定すると 背景レイヤ になります。  　0 以上の整数を指定すると前景レイヤになります。  　message0 または message1 を指定するとメッセージレイヤにな ります。単に message とのみ指定した場合は、[current](#current) タグで指定した現在の操作対象のメッセージレイヤが 対象になります ( 裏ページのメッセージレイヤが操作対象であっても そのメッセージレイヤの表ページ→裏ページへのコピーが行われます )。  　省略すると、すべてのレイヤの情報が裏ページにコピーされます。 |

指定したレイヤ、あるいはすべてのレイヤの情報を、表ページから裏ページに
コピーします。
　コピーされるのは、[copylay](#copylay) タグでコピーされる
情報と同じです。
　[trans](#trans) タグは表ページのレイヤの画像を裏ページの
レイヤの画像に置き換えます。そのため、トランジション前にこの backlay タ
グで画像を裏ページに転送し、裏ページでレイヤを操作してから、トランジションを
行うという方法に用います。

[ジャンル・タグ一覧に戻る](#genre)

# bgmopt ( BGM の設定 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| volume | no | 音量% (0～100) | BGM の音量を % で指定します。初期状態の KAG では 100 % です。省略すれば音量は変更されません。  　100 が上限です。音量の抑制のみをサポートします(増幅は 音源の特性上、できません)。 |
| gvolume | no | 音量% (0～100) | BGM の大域音量を % で指定します。初期状態の KAG では 100 % です。省略すれば音量は変更されません。  　大域音量は volume 属性で指定する通常の音量とは別に、 BGM の音量を制御することができるもう一つのものです。実際に再生 される音量は、通常の音量と大域音量を掛け合わせた音量になります ( たとえば volume=50 で gvolume=75 ならば 50(%)\*75(%)=37.5(%) )  　大域音量はシステム変数に記録され、次回起動時 にも引き継がれます ( 各栞に保存されるわけではありません )。 |

BGM のさまざまな設定を
変更します。

[ジャンル・タグ一覧に戻る](#genre)

# button ( グラフィカルボタン )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| graphic | yes | 画像ファイル名 | ボタンにする画像を指定します。  　[image](#image) タグの storage 属性を参照してください。 |
| graphickey | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | ボタンにする画像のカラーキーを指定します。  　[image](#image) タグの key 属性を参照してください。 |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| recthit | no | true(デフォルト) または false | 矩形で当たり判定を行うかどうかを指定します。true が指定されていると、 ボタンの表示されている矩形全域でマウスのクリックなどに反応します。 false が指定されていると、ボタンの不透明度が 64 未満の領域では マウスのクリックなどに反応しなくなります。  　省略すると true が指定されたと見なされます。 |
| exp | no | TJS 式 | クリックされたときに実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |
| hint | no | ヒントとして表示させる文字列 | リンクを選択し、マウスカーソルを静止させたときに表示される ツールチップヒントを指定します。  　省略すると表示は行われません。 |
| onenter | no | TJS 式 | ボタン内にマウスカーソルが入ってきたときに実行される TJS 式を 指定します。 |
| onleave | no | TJS 式 | ボタン内からマウスカーソルが出ていった時に実行される TJS 式を 指定します。 |
| countpage | no | true(デフォルト) または false | ボタンを選択して他のラベルに移行するときに、このリンクのある 場所のラベルを「読んだ」とみなすかどうかを指定します。  　[s] タグを実行する前にボタンが選択されてジャンプする際に、 そのページが「読んだ」ことになっては困る場合に false を指定します。 |
| clickse | no | 効果音ファイル名 | クリックされたときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| clicksebuf | no | 効果音バッファ番号 | clickse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |
| enterse | no | 効果音ファイル名 | マウスが進入したときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| entersebuf | no | 効果音バッファ番号 | enterse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |
| leavese | no | 効果音ファイル名 | マウスが退出したときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| leavesebuf | no | 効果音バッファ番号 | leavese で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |

現在のメッセージレイヤ上に [link](#link) タグと
同様にリンクを作成しますが、
画像を用いたボタンを作成します。
　ボタンが作成される位置は [locate](#locate) タグで指定した
位置が画像の左上点になりますので、このタグを使う前に locate タグで
位置を指定してください。このタグは文字表示位置を移動しません。
　graphic 属性で指定する画像は、
・通常の状態
・ボタンが押された状態
・ボタンの上にマウスカーソルがある状態
　の3つの画像が左から順に横並びになった画像です。一つの画像に、同じサイズの３つの状態の画像が横に並んだ形式になっています。つまり、この属性で指定する画像は、ボタンの横幅の３倍の横幅を持つことになります。
　このタグを使う場合は、なるべく s タグですぐに選択肢待ちにしてください。

[ジャンル・タグ一覧に戻る](#genre)

# call ( サブルーチンの呼び出し )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | 呼び出したいサブルーチンのあるのシナリオファイルを 指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | 呼び出すサブルーチンのラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| countpage | no | false(デフォルト) または true | 他のラベルに移行するときに、このタグのある 場所のラベルを「読んだ」とみなすかどうかを指定します。  　サブルーチンを呼び出す際に、呼び出し元のページが その時点で「読まれた」ことにしたい場合に true を 指定します。 |

指定されたシナリオファイルの指定されたラベルで示される
サブルーチンを呼び出します。
　呼び出されたサブルーチンは、 [return](#return) タグで
呼び出し元や任意の場所に戻ることができます。

[ジャンル・タグ一覧に戻る](#genre)

# cancelautomode ( 「自動的に読み進む」の解除 )

メッセージ操作

「自動的に読み進む」を強制的に解除します。

[ジャンル・タグ一覧に戻る](#genre)

# cancelskip ( スキップの解除 )

メッセージ操作

スキップ状態の解除を行います。
　スキップ状態とは、クリックスキップ ( メッセージ表示途中で画面
をクリックすることによりクリック待ちまで一気に文章を表示する機
能 ) と、「次の選択肢まですすむ」でスキップが行われている状態の
事です。
　「次の選択肢まで進む」機能自体が無効になったり、クリックスキップの
機能自体がそれ以降無効になったりするわけではありません。

[ジャンル・タグ一覧に戻る](#genre)

# cancelvideoevent ( ピリオドイベントの解除 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

[videoevent](#videoevent)タグで設定したピリオドイベントを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# cancelvideosegloop ( ビデオのセグメントループ再生の解除 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

[videosegloop](#videosegloop)タグで設定したセグメントループを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# cclick ( クリック待ち解除 )

ラベル・ジャンプ操作

click で現在のメッセージレイヤに対して登録されたクリック待ちを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# ch ( 文字を表示する )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| text | yes | 文字 | ここで指定した文字が表示されます。  　複数の文字を指定できますが、自動改行はされません ( メッセージ履歴レイヤも ここで複数の文字を指定された場合は改行されません )。また、複数の 文字を指定した場合は一気に表示されます ( nowait で表示するよりも かなり高速 )。通常は一文字のみを指定します。 |

文字を current タグで指定したメッセージレイヤに表示します。普通は使いません。
　KAG 内部では、通常の文字は、一文字一文字すべてがこのタグに分解されて処理されます。

[ジャンル・タグ一覧に戻る](#genre)

# checkbox ( チェックボックスの作成 )

フォーム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | 変数名 | チェックボックスの状態を格納する変数を指定します。  　変数が 0 (または未定義)ならばチェックされていない、0 でなければ チェックされているとみなされます。  　もし変数がすでに 0 以外であれば、チェックボックスはチェックされた 状態で作成されます。 |
| bgcolor | no | 0xRRGGBB 形式 | 背景色を 0xRRGGBB 形式で指定します。 |
| opacity | no | 0(完全透明) ～ 255(完全不透明) | bgcolor 属性で指定した背景色の不透明度を 0 ～ 255 で指定します。 |
| color | no | 0xRRGGBB 形式 | チェックマークの色を 0xRRGGBB 形式で指定します。 |

現在操作対象になっているメッセージレイヤの、現在の位置に、チェックボックスを作成します。
　チェックボックスの状態は、[commit](#commit) タグが
実行されるまで、指定した変数に代入されることはありません。
　commit タグが実行されると、チェックボックスがチェックされていれば 1 が、
チェックされていなければ 0 が変数に入ります。

[ジャンル・タグ一覧に戻る](#genre)

# clearbgmlabel ( BGM のラベル通過処理の解除 )

効果音・BGM・ビデオ操作

setbgmlabelの指定をクリアします

[ジャンル・タグ一覧に戻る](#genre)

# clearbgmstop ( BGM の停止処理の解除 )

効果音・BGM・ビデオ操作

setbgmstopの指定をクリアします

[ジャンル・タグ一覧に戻る](#genre)

# clearsysvar ( システム変数の全消去 )

システム操作

システム変数をすべて消去します。

[ジャンル・タグ一覧に戻る](#genre)

# clearvar ( ゲーム変数の全消去 )

変数・TJS 操作

ゲーム変数をすべて消去します。すべてのゲーム変数は未定義になります。

[ジャンル・タグ一覧に戻る](#genre)

# clearvideolayer ( ビデオレイヤ解除 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| channel | yes | 1 または 2 | レイヤ描画モードによる描画を解除したいチャンネルを指定します。 |

[videolayer](#videolayer)タグで設定したレイヤを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# click ( クリック待ちジャンプ )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| exp | no | TJS 式 | クリック時に実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |
| se | no | 効果音ファイル名 | クリック時に再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| sebuf | no | 効果音バッファ番号 | clickse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |

現在のメッセージレイヤに対してクリック待ちを登録します。
リンクやボタンが無い場所をクリックした場合に反応します。
　このタグを使う場合は、なるべく s タグですぐに選択肢待ちにしてください。

[ジャンル・タグ一覧に戻る](#genre)

# clickskip ( クリックスキップの設定 )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| enabled | yes | true または false | クリックスキップ機能を有効にする場合は true、無効にする場合は false を指定します。 |

クリックスキップとは、メッセージ表示途中で画面をクリックすることにより、
トランジションや自動移動を中断したり、
クリック待ちまで一気に文章を表示する機能です。
　デモシーンなどでは無効にしていたほうがいい場合があります。

[ジャンル・タグ一覧に戻る](#genre)

# close ( ウィンドウを閉じる )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| ask | no | true(デフォルト) または false | true を指定すると、終了するかどうかの確認をします。false を 指定するとこの確認はありません。この属性を省略 すると、 true を指定したとみなされます。  　この確認でユーザが「いいえ」を選んだ場合、実行は そのまま継続します。 |

ウィンドウを閉じます。ask 属性に false を指定しない限り、終了確認があります
( バージョン情報ダイアログでは終了確認は出ません )。

[ジャンル・タグ一覧に戻る](#genre)

# cm ( すべてのメッセージレイヤのクリア )

メッセージ操作

すべてのメッセージレイヤのクリアを行います。
　すべてのメッセージレイヤの文字は消去されますが、[ct](#ct) タグのように
操作対象のメッセージレイヤが表ページの message0 に指定されるようなことはありません。
このタグを実行後も操作対象のレイヤは同じです。
　[font](#font) タグで指定した文字の属性、[style](#style) タグ
で指定したスタイルはすべて標準状態に戻ります。ただ
し、[position](#position) タグ
や [layopt](#layopt) タグで指定した属性は引き継が
れます。
　「\*ラベル名|見出し名」 形式のラベルの次には、この cm タグあるい
は [ct](#ct) タグを書くべきです。
( 栞のロード時にはラベルから実行が始まるが、ロード時には必ずメッセ
ージレイヤ上の文字がクリアされるため )。

[ジャンル・タグ一覧に戻る](#genre)

# commit ( フォーム内容の確定 )

フォーム操作

現在操作対象になっているメッセージレイヤ上のすべてのエディットや
チェックボックスなどの「フォーム要素」の内容を確定します。
　内容が確定されると、フォーム要素で編集されていた文字列や状態が、
各変数に実際に代入されます。
　各フォーム要素は [er](#er) や [ct](#ct) タグのような
メッセージレイヤを消去する系のタグで消去されてしまいますので、そのまえに
commit タグを実行する必要があります。

`例:
*editname
@er
名字 : [edit name="f.sname" length=200][r]
名前 : [edit name="f.name" length=200][r]
[link target=*ok]OK[endlink][r]
[link target=*cancel]キャンセル[endlink][s]
*ok
; OK が選択された
; commit を行って変数に代入を行う
[commit]
[jump target=*exit]
*cancel
; キャンセルが選択された
; commit は行わない
[jump target=*exit]`

[ジャンル・タグ一覧に戻る](#genre)

# copybookmark ( 栞のコピー )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| from | yes | 0または正の整数 | コピー元の栞の番号を指定します。省略すると 0 が指定されたと見なされます。 |
| to | yes | 0または正の整数 | コピー先の栞の番号を指定します。省略すると 0 が指定されたと見なされます。 |

非フリーセーブモードにおいて、from 属性で指定された番号の栞から to 属性で指
定された番号の栞へ内容のコピーを行います。

[ジャンル・タグ一覧に戻る](#genre)

# copylay ( レイヤ情報のコピー )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| srclayer | yes | "base" または 0 または 1 または 2 また は message0 または message1 または message | コピー元となるレイヤを指定します。  　この属性と srcpage 属性で指定したレイヤがコピー元になります。  　base を指定すると 背景レイヤ になります。  　0 または 1 または 2 を指定すると前景レイヤになります。  　message0 または message1 を指定するとメッセージレイヤにな ります。単に message とのみ指定した場合は、[current](#current) タグで指定した現在の操作対象のメッセージレイヤが 対象になります。 |
| destlayer | yes | "base" または 0 または 1 または 2 また は message0 または message1 または message | コピー先となるレイヤを指定します。  　この属性と destpage 属性で指定したレイヤがコピー先になります。  　base を指定すると 背景レイヤ になります。  　0 または 1 または 2 を指定すると前景レイヤになります。  　message0 または message1 を指定するとメッセージレイヤにな ります。単に message とのみ指定した場合は、[current](#current) タグで指定した現在の操作対象のメッセージレイヤが 対象になります。 |
| srcpage | no | "fore" または "back" | コピー元となるページを指定します。  　この属性と srclayer 属性で指定したレイヤがコピー元になります。  　"fore" を指定すると表ページ、"back" を指定すると裏ページになります。 省略すると "fore" を指定したと見なされます。 |
| destpage | no | "fore" または "back" | コピー先となるページを指定します。  　この属性と destlayer 属性で指定したレイヤがコピー元になります。  　"fore" を指定すると表ページ、"back" を指定すると裏ページになります。 省略すると "fore" を指定したと見なされます。 |

指定したレイヤの情報をコピーします。
　ただし、同種のレイヤ ( 背景レイヤ同士、前景レイヤ同士、メッセージレイヤ同士 )でのみ
コピーできます。

[ジャンル・タグ一覧に戻る](#genre)

# ct ( メッセージレイヤのリセット )

メッセージ操作

メッセージレイヤをリセットします。
　すべてのメッセージレイヤの文字は消去され、操作対象のメッセージレイヤは
表ページの message0 に指定されます。
　[font](#font) タグで指定した文字の属性、[style](#style) タグ
で指定したスタイルはすべて標準状態に戻ります。ただ
し、[position](#position) タグ
や [layopt](#layopt) タグで指定した属性は引き継が
れます。
　これに対し、[er](#er) タグは、現在の操作対象のメッセージ
レイヤ上の文字を消去したり文字やスタイルの属性を標準状態に戻したりす
るだけです。
　「\*ラベル名|見出し名」 形式のラベルの次には、この ct タグあるい
は [cm](#cm) タグを書くべきです。
( 栞のロード時にはラベルから実行が始まるが、ロード時には必ずメッセ
ージレイヤ上の文字がクリアされるため )。

[ジャンル・タグ一覧に戻る](#genre)

# ctimeout ( タイムアウト待ち解除 )

ラベル・ジャンプ操作

timeout で現在のメッセージレイヤに対して登録されたタイムアウトを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# current ( 操作対象のメッセージレイヤの指定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | no | "message0" または "message1" | 操作対象とするメッセージレイヤを指定します。 |
| page | no | "fore"(デフォルト) または "back" | 表(fore)画面のレイヤを対象とするか、裏(back)画面のレイヤを対象と するかを指定します。省略すると表ページであると見なされます。 |
| withback | no | true または false (デフォルト) | 表ページが対象の場合、裏ページにも同様に文字を描画するかを 指定します。この属性を省略すると false が指定されたとみなされます。 　裏ページに同時に文字を描画する必要があるのは、同時にトランジションを 進行させる場合などです。 |

操作対象とするメッセージレイヤを指定します。以後、文章や
[font](#font) タグでの文字属性の指定、[l](#l)
タグ等のクリック待ちなどは、このレイヤに対して行われます。
　message0 はデフォルトで可視の状態で
すが、message1 は [layopt](#layopt) タグ
等で visible=true としないと表示されないので注意してください。

[ジャンル・タグ一覧に戻る](#genre)

# cursor ( マウスカーソルの変更 )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| default | no | cr で始まるカーソル定数 または カーソルファイル名 | 通常のマウスカーソルを指定します。 |
| pointed | no | cr で始まるカーソル定数 または カーソルファイル名 | リンクやボタンをポイントしたときのマウスカーソルを指定します。 |
| click | no | cr で始まるカーソル定数 または カーソルファイル名 | クリック待ちのマウスカーソルを指定します。 |
| draggable | no | cr で始まるカーソル定数 または カーソルファイル名 | [position](#position) タグで draggable=true としたときに、 マウスがメッセージレイヤをドラッグ可能な位置に来たときに表示される マウスカーソルを指定します。 |

マウスカーソルを変更します。いずれの属性も省略すれば設定は変わりません。
　cr で始まるマウスカーソル定数については、吉里吉里 SDK ヘルプの
「マウスカーソル定数一覧」を参照してください。また、その場合
は default=&crArrow のように、定数の前に & 記号をつけて指定してください。
　マウスカーソルファイルには、.cur または .ani の拡張子を持つマウスカーソル
ファイルを指定することができます ( 拡張子は省略しないでください )。

[ジャンル・タグ一覧に戻る](#genre)

# cwheel ( ホイール待ち解除 )

ラベル・ジャンプ操作

wheel で現在のメッセージレイヤに対して登録されたホイール待ちを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# deffont ( デフォルトの文字属性設定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| size | no | 文字サイズ(pixel単位) | デフォルトの文字サイズを指定します。 |
| face | no | フォント名 または "user" | デフォルトのフォント名を指定します。 |
| color | no | 0xRRGGBB 形式 | デフォルトの文字色を指定します。 |
| rubysize | no | ルビの文字サイズ(pixel単位) | デフォルトのルビの文字のサイズを指定します。 |
| rubyoffset | no | ルビの表示オフセット(pixel単位) | デフォルトのルビの表示オフセットを指定します。 |
| shadow | no | true または false | デフォルトで文字に影をつけるかを指定します。 |
| edge | no | true または false | デフォルトで文字を袋文字 ( 縁取り文字 ) にするかを指定します。 |
| edgecolor | no | 0xRRGGBB 形式 | デフォルトの文字の袋の色を指定します。 |
| shadowcolor | no | 0xRRGGBB 形式 | デフォルトの影の色を指定します。 |
| bold | no | true または false | デフォルトで文字を太文字にするかを指定します。 |

現在操作対象のメッセージレイヤに対する、デフォルトの文字属性を指定します。
　各属性の詳細については [font](#font)タグを指定してください。ただし
属性の値として "default" を指定することはできません。
　ここで指定した属性は、[resetfont](#resetfont) タグで実際に反映されます。
　逆に言うと、このタグを実行しただけではすぐにはフォントの属性は反映されません。resetfont タグ
を実行する必要があります。

[ジャンル・タグ一覧に戻る](#genre)

# defstyle ( デフォルトのスタイルの設定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| linespacing | no | 行間 (pixel単位) | デフォルトの行間を指定します。 |
| pitch | no | 字間オフセット(pixel単位) | デフォルトの字間のオフセットを pixel 単位で指定します。 |
| linesize | no | 予約サイズ(pixel単位) | デフォルトの行の幅を指定します。 |

現在操作対象のメッセージレイヤに対する、デフォルトの行のスタイルを指定します。
　各属性の詳細については [style](#style)タグを指定してください。ただし
属性の値として "default" を指定することはできません。
　ここで指定した属性は、[resetstyle](#resetstyle) タグで実際に反映されます。
　逆に言うと、このタグを実行しただけではすぐにはフォントの属性は反映されません。resetstyle タグ
を実行する必要があります。

[ジャンル・タグ一覧に戻る](#genre)

# delay ( 文字の表示速度の設定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| speed | yes | "nowait" または "user" またはウェイトの値(ms単位) | "nowait" を指定すると、文字の表示にウェイトをかけずに、 一気に文字が表示されます。"user" を指定すると、 [システム|文字速度] でユーザーが指定した速度になりま す(デフォルト)。ウェイトの値を指定すると、値で示した 時間につき 1 文字の速度で文字を表示します。  　文字表示速度は、すべてのメッセージレイヤで同じになります。 |

文字の表示速度を指定します。
　文字表示をノーウェイトにするには [nowait](#nowait) タグをつかう
こともできます。

[ジャンル・タグ一覧に戻る](#genre)

# disablestore ( 栞の機能の一時的な使用不可 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| store | no | true(デフォルト) または false | 「栞をはさむ」の機能を使用不可にするかを指定します。  　使用不可にするときに true を設定します。 |
| restore | no | true または false(デフォルト) | 「栞をたどる」の機能を使用不可にするかを指定します。  　使用不可にするときに true を設定します。  　store 属性と違い、こちらは属性を省略すると false であると見なされます。 |

「栞をはさむ」の機能を一時的に使用不可能にします。
　以後、セーブ可能なラベルを通過しない限り「栞をはさむ」の機能は使用不可能になります。
　KAG 起動直後は、この「使用不可能」で「栞をはさむ」が使用不可の状態になっており、セーブ可能なラベルを通過しない限り「栞をはさむ」の機能は使用できません。
　ゲームのメインメニューなど、栞をはさんでも仕方のないところに記述します。
　このタグに対し、[store](#store) タグでは栞をはさむ・たどる
の両方の機能を恒久的に使用不可・可に設定できます。

[ジャンル・タグ一覧に戻る](#genre)

# edit ( 単一行エディットの作成 )

フォーム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | 変数名 | 入力した文字列を格納する変数を指定します。  　もし変数にすでに文字列が入っていた場合は、単一行 エディットの初期文字列として表示されます。 |
| length | no | 幅 (pixel 単位) | 単一行エディットの幅 ( 縦書きの場合は高さ ) をピクセル単位で指定します。 |
| bgcolor | no | 0xRRGGBB 形式 | 背景色を 0xRRGGBB 形式で指定します。 |
| opacity | no | 0(完全透明) ～ 255(完全不透明) | bgcolor 属性で指定した背景色の不透明度を 0 ～ 255 で指定します。 |
| color | no | 0xRRGGBB 形式 | 文字色を 0xRRGGBB 形式で指定します。 |
| maxchars | no | 最大文字数 | 入力できる最大文字数を指定します。0 を指定すると無制限になります。  　デフォルトでは無制限です。 |

現在操作対象になっているメッセージレイヤの、現在の位置に、現在のフォントで、一行のみの文字列を編集できる
入力欄(エディット)を作成します。
　編集がおこなわれた文字列は、[commit](#commit) タグが
実行されるまで、指定した変数に代入されることはありません。

[ジャンル・タグ一覧に戻る](#genre)

# else ( if の中身が実行されなかったときに実行 )

変数・TJS 操作

[if](#if) タグもしくは [elsif](#elsif) タグ
と [endif](#endif) タグの間で用いられます。
if または elsif ブロックの中身がひとつも実行されていないとき、
else から endif までの間を実行します。
　使い方の例については、[if](#if) タグの項目を参照してください。

[ジャンル・タグ一覧に戻る](#genre)

# elsif ( それまでの if の中身が実行されていなかったときに、条件付きで実行 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。 |

[if](#if) タグと [endif](#endif) タグの間で用いられます。
それまでの if タグまたは elsif タグの中身がひとつも実行されていないときに
式を評価し、その結果が真ならば elsif から次の elsif・else・endif までの間を実行します。
　使い方の例については、[if](#if) タグの項目を参照してください。

[ジャンル・タグ一覧に戻る](#genre)

# emb ( 式評価結果の埋め込み )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。ここで評価された式の結果が、 この emb タグと置き換わります。 |

exp で示された式を評価(実行)し、その結果を埋め込みます。
　変数をシナリオ中に表示させたい場合に使います。
　通常は、[eval](#eval) タグで代入した 変数の内容に
置き換えます。

`例:
[eval exp="f.value1='変数の値だよ～ん'"]

とどこかで書いておいて、

[emb exp="f.value1"]

と書くと、この emb タグが 変数の値だよ～ん という内容に置き換わります。`

[ジャンル・タグ一覧に戻る](#genre)

# endhact ( メッセージ履歴アクションの終了 )

メッセージ履歴操作

[hact](#hact) タグで設定したメッセージ履歴アクションを
終了(設定をクリア)します。

[ジャンル・タグ一覧に戻る](#genre)

# endif ( 条件によりシナリオを実行(の終了) )

変数・TJS 操作

[if](#if) タグの終了を示します。endignore とまったく
同一の動作をします。

[ジャンル・タグ一覧に戻る](#genre)

# endignore ( 条件によりシナリオを無視(の終了) )

変数・TJS 操作

[ignore](#ignore) タグの終了を示します。

[ジャンル・タグ一覧に戻る](#genre)

# endindent ( インデントの解除 )

メッセージ操作

[indent](#indent) タグで設定したインデントを解除します。通常は改行の前に記述します。

[ジャンル・タグ一覧に戻る](#genre)

# endlink ( ハイパーリンク(の終了) )

ラベル・ジャンプ操作

[link](#link) タグで開始したハイパーリンクの終了を示します。

[ジャンル・タグ一覧に戻る](#genre)

# endmacro ( マクロの記述(の終了) )

マクロ操作

[macro](#macro) タグで記述を開始したマクロの終了を示します。

[ジャンル・タグ一覧に戻る](#genre)

# endnowait ( 文字表示ノーウェイト(の終了) )

メッセージ操作

文字の表示速度を、[nowait](#nowait) タグでノーウェイト
にする直前の文字表示速度に戻します。

[ジャンル・タグ一覧に戻る](#genre)

# endscript ( TJS スクリプトの記述(の終了) )

変数・TJS 操作

[[iscript](#iscript)] で記述したスクリプトの記述の終了を
示します。
このタグのある行には、このタグしか書いてはいけません ( 行末の \ 記号も不可 )。

[ジャンル・タグ一覧に戻る](#genre)

# er ( メッセージレイヤの文字の消去 )

メッセージ操作

現在の操作対象のメッセージレイヤ上の文字を消去します。
　[ct](#ct) タグと違うのは、er タグは現在のメッセージ
レイヤ上の文字を消去し、文字属性とスタイルをリセットするだけで、
ct タグのようにすべてのメッセージレイヤ上の文字を消去したり、
操作対象のレイヤを message0 に戻したりしません。

[ジャンル・タグ一覧に戻る](#genre)

# erasebookmark ( 栞の消去 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| place | no | 0または正の整数(0がデフォルト) | 栞の番号を指定します。省略すると 0 が指定されたと見なされます。 |

非フリーセーブモードにおいて、指定した番号の栞を消去します。栞は"(未設定)"になります。

[ジャンル・タグ一覧に戻る](#genre)

# erasemacro ( マクロの消去 )

マクロ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | タグ名 | 消去するタグを指定します。マクロとして定義されたタグのみを 消去することが出来ます。 |

[macro](#macro) タグで記述したマクロを消去します。

[ジャンル・タグ一覧に戻る](#genre)

# eval ( 式の評価 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。 |

exp で示された式を評価します。通常は変数への値の代入に用います。
　exp には任意の TJS 式を指定できるので、TJS として有効な式であれば
何でも評価できます。

`例:
[eval exp="f.test=500"]
;↑ゲーム変数 test に数値を代入している
[eval exp="f.test2='文字列'"]
;↑ゲーム変数 test2 に文字列を代入している
[eval exp="sf.test=400"]
;↑システム変数 test に数値を代入している
[eval exp="f.test2=f.test*3"]
;↑ゲーム変数 test2 に ゲーム変数 test の 3 倍の数値を代入している`

[ジャンル・タグ一覧に戻る](#genre)

# fadebgm ( BGMのフェード )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| volume | yes | 音量% (0～100) | フェード後に到達させる BGM の音量を % で指定します。  　100 が上限です。音量の抑制のみをサポートします(増幅は 音源の特性上、できません)。 |
| time | yes | 時間(ms単位) | フェードを行っている時間を ms 単位で指定します。 3000 と指定すれば 3 秒間の間、フェードを行っています。 |

現在演奏中の BGM を指定音量までフェードします。
　フェード終了後も曲は演奏されたままです。
　このタグはフェードの終了を待ちません。フェードの終了を待つに
は、[wb](#wb) タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadeinbgm ( フェードインしながらのBGM再生開始 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | BGM ファイル名 または CD トラック番号 | 演奏する BGM ファイル名または CD トラック番号を指定します。 |
| start | no | BGM 開始位置指定 | ループチューナで指定したラベルで BGM の再生開始位置を指定します。 |
| loop | no | true(デフォルト) または false | BGM をループするかを指定します。  　true を指定するとループします。false を指定すると ループしません。  　省略すると true であると見なされます。 |
| time | yes | 時間(ms単位) | フェードインを行っている時間を ms 単位で指定します。 3000 と指定すれば 3 秒間の間、フェードインを行っています。 |

BGM ファイルを演奏しますが、曲の先頭でフェードインを行います。
　このタグはフェードの終了を待ちません。フェードの終了を待つに
は、wb タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadeinse ( 効果音のフェードイン再生 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 効果音を再生するバッファを指定します。一つのバッファでは 同時には一つの効果音を鳴らすことができます。  　省略すると 0 であると見なされます。 |
| storage | yes | 効果音ファイル名 | 演奏する効果音ファイル名を指定します。  　拡張子は省略可能ですが、省略した場合に自動的に探し出されるのは .wav または .ogg または .mp3 の拡張子を持つファイルだけです。 ( ただし ogg と mp3 の再生には SDK 付属のプラグインが必要 )  そのほかのプラグインで使用可能になるそのほかの ファイル形式を指定する場合は拡張子も指定してください。 |
| start | no | SE 開始位置指定 | ループチューナで指定したラベルで SE の再生開始位置を指定します。 |
| time | yes | フェードイン時間(ms) | フェードインを行っている時間をミリ秒単位で指定します。 |
| loop | no | true または false(デフォルト) | 効果音を繰り返し再生するかどうかを指定します。  　true を指定すると繰り返し再生されます。false を 指定すると一回限りの再生となります。省略すると false であると見なされます。  　true を指定した場合は [ws](#ws) タグ で効果音再生の終了を待つことはできません。 |

効果音をフェードインしながら再生します。
　このタグはフェードの終了を待ちません。
待つには [wf](#wf) タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadeoutbgm ( BGMのフェードアウト )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | 時間(ms単位) | フェードアウトを行っている時間を ms 単位で指定します。 3000 と指定すれば 3 秒間の間、フェードアウトを行っています。 |

現在演奏中の BGM をフェードアウトします。
　フェードアウトが終了すると曲は自動的に停止します。
　このタグはフェードの終了を待ちません。フェードの終了を待つに
は、wb タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadeoutse ( 効果音のフェードアウト )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 効果音をフェードアウトするバッファを指定します。  　省略すると 0 であると見なされます。 |
| time | yes | フェードアウト時間(ms) | フェードアウトを行っている時間をミリ秒単位で指定します。 |

効果音をフェードアウトします。フェードアウトし終わると再生は
自動的に停止します。
　このタグはフェードの終了を待ちません。
待つには [wf](#wf) タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadepausebgm ( BGM 演奏のフェードアウトしながらの一時停止 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | 時間(ms単位) | フェードアウトを行っている時間を ms 単位で指定します。 3000 と指定すれば 3 秒間の間、フェードアウトを行っています。 |

BGM 演奏をフェードアウトしながら一時停止します。Config.tjs で BGM 再生メディアに "Wave" を指定
した場合のみに有効です。
　BGM の一時停止状態は栞に保存されますが、一時停止していた場合の BGM の
再生位置の情報は保存されないので注意してください。
　一時停止した BGM を再開するには [resumebgm](#resumebgm) タグ
を使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# fadese ( 効果音のフェード )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 効果音をフェードするバッファを指定します。  　省略すると 0 であると見なされます。 |
| time | yes | フェード時間(ms) | フェードを行っている時間をミリ秒単位で指定します。 |
| volume | yes | 音量% (0～100) | フェードの到達音量を % で指定します。 　100 が上限です。音量の抑制のみをサポートします(増幅は 音源の特性上、できません)。 |

効果音を指定の到達音量までフェードします。
　このタグはフェードの終了を待ちません。
待つには [wf](#wf) タグを使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# font ( 文字属性設定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| size | no | 文字サイズ(pixel単位) または "default" | 文字サイズを pixel 単位で指定します。 |
| face | no | フォント名 または "default" または "user" | フォント名を指定します。  　フォント名には曖昧な指定はできません。スペース、半角／全角も正確に指定してください。  　複数のフォント名をカンマで区切って指定できます。この場合は、最初の方に書いた フォントが存在すれば、それが優先されて選択されます。  　例 : face="HG行書体,ＭＳ Ｐゴシック"  　縦書き用フォントは自動的に設定されますので、フォント名の先頭に @ マークをつける 必要はありません。 　"user" を指定すれば、メニューの [文字表示|フォント] でユーザが選択したフォントに なります。 |
| color | no | 0xRRGGBB 形式 または "default" | 文字色を 0xRRGGBB 形式で指定します。 |
| italic | no | true または false または "default" | 文字を斜体にするかどうかを指定します。true を指定すると斜体になりま す。 |
| rubysize | no | ルビの文字サイズ(pixel単位) または "default" | ルビ(読み仮名)の文字のサイズを pixel 単位で指定します。 |
| rubyoffset | no | ルビの表示オフセット(pixel単位) または "default" | ルビの表示オフセットを pixel 単位で指定します。負の数を指定すると本文に より近い位置に表示されます。 |
| shadow | no | true または false または "default" | 文字に影をつけるかを指定します。true を指定すると影がつきます。 |
| edge | no | true または false または "default" | 文字を袋文字 ( 縁取り文字 ) にするかを指定します。true を指定すると袋文字になります。 |
| edgecolor | no | 0xRRGGBB 形式 または "default" | 文字の袋の色を 0xRRGGBB 形式で指定します。 |
| shadowcolor | no | 0xRRGGBB 形式 または "default" | 影の色を 0xRRGGBB 形式で指定します。 |
| bold | no | true または false または "default" | 文字を太文字にするかを指定します。 true を指定すると太文字になります。 |

文字の様々な属性を指定します。
　これらの属性は、メッセージレイヤごとに個別に設定できます。
　いずれの属性も、省略すると前の状態を引き継ぎます。また、default を指定すると
Config.tjs 内で指定したデフォルトの値に戻ります。
　edge と shadow は同時に true にした場合は、袋文字のみが有効になり、影は無視されます。
　これらの属性は、[resetfont](#resetfont) タ
グや [ct](#ct) [cm](#cm) [er](#er) タグが実行され
ると、Config.tjs 内や [deffont](#deffont) タグで指定し
たデフォルトの値に戻ります。

[ジャンル・タグ一覧に戻る](#genre)

# freeimage ( レイヤ画像の解放 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | 画像を解放するレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |

レイヤの画像を解放します。
　とくにアニメーション情報を保持しているレイヤは、非表示にしていても CPU パワーを
使用するので、不必要になった時点でこのタグを使って解放するといいかと思います。

[ジャンル・タグ一覧に戻る](#genre)

# glyph ( クリック待ち記号の指定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| line | no | 行末クリック待ち記号ファイル名 | 行末クリック待ち記号画像のファイル名を指定します。 拡張子は指定しないでください。 |
| linekey | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | カラーキーを指定します。  　[image](#image) タグの key 属性を参照してください。 |
| page | no | 改ページクリック待ち記号ファイル名 | 改ページ待ち記号画像のファイル名を指定します。  拡張子は指定しないでください。 |
| pagekey | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | カラーキーを指定します。  　[image](#image) タグの key 属性を参照してください。 |
| fix | no | true または false | 記号表示位置を指定位置に固定するかどうかを指定します。true を指定すると 記号は left および top を指定した位置に表示されます。  　false を指定すると left および top 属性は無視され、記号は現在の文字表示 位置に表示されるようになります。 |
| left | no | 左端位置(pixel単位) | fix 属性を true にしたときに記号を表示する位置のうち、左端位置を 指定します。 |
| top | no | 上端位置(pixel単位) | fix 属性を true にしたときに記号を表示する位置のうち、上端位置を 指定します。 |

クリック待ちに用いる画像を指定します。
　line や page 属性で指定されたファイル名の画像が記号として、そのファイル名に .asd を
つけたファイル名が アニメーションレイヤのスクリプトとして読み込まれます。
　アニメーションレイヤ用の画像やスクリプトの書き方については、AnimationLayer.tjs を
参照してください。
　これらの設定は、メッセージレイヤごとに個別に設定できます。

[ジャンル・タグ一覧に戻る](#genre)

# goback ( 前に戻る )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| ask | no | true または false(デフォルト) | true を指定すると、前に戻るかどうかの確認をします。false を 指定すると前に戻るかどうかの確認はありません。この属性を省略 すると false を指定したとみなされます。  　前に戻るかどうかの確認でユーザが「いいえ」を選んだ場合、実行は そのまま継続します。 |

メニューから システム|前に戻る を選択したときと同じ動作をします。

[ジャンル・タグ一覧に戻る](#genre)

# gotostart ( 最初に戻る )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| ask | no | true または false(デフォルト) | true を指定すると、最初に戻るかどうかの確認をします。false を 指定すると最初に戻るかどうかの確認はありません。この属性を省略 すると false を指定したとみなされます。  　最初に戻るかどうかの確認でユーザが「いいえ」を選んだ場合、実行は そのまま継続します。 |

[startanchor](#startanchor) タグで指定された場所に戻ります。
　メニューから システム|最初に戻る を選択したときと同じ動作をします。

[ジャンル・タグ一覧に戻る](#genre)

# graph ( インライン画像表示 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | 画像ファイル名 | 表示させたい画像ファイル名を指定します。 読み込める形式は [image](#image)タグで読み込める 形式と同じです。 　ここで指定したファイル名 (拡張子を除く) 部分に \_m を追加 したファイルが、もしあれば、マスク画像として読み込まれます。 マスク画像は必ず 256 色グレースケールで保存してください。 |
| key | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | どの色を抜き色とするかを指定します。省略すると抜き色は無効になります。 　key=0xRRGGBB という形式で 16 進数で抜き色を指定する と、RR(赤) GG(緑) BB(青)で塗られた部分を抜き色として透明にします。 たとえば、key=0xff00ff では (r,g,b)=(255,0,255) つまり真マゼンダの部 分を抜き色として透明にするという指定になります。  　ただ単に数値を指定すれば、そのパレットインデックスの数値が抜き 色となります。16色/256色の画像に対して有効です。  　key=adapt と指定すれば、自動的に抜き色が決定されます。 使用される抜き色は、画像の一番上のラインにて、一番多く使われている色です。 16色/256色の画像に対して有効です。  　マスク画像を使用する場合は、このタグを指定する必要はありません。 |
| char | no | true (デフォルト) または false | true を指定すると、画像は[font](#font) タグで 指定した色、影、袋文字の状態が、文字同様に表示されます。 そのため、true を設定すると画像の色情報は無視されます。 また、画像が影や袋文字である必要はありません。  　graph タグが特殊記号の表示に使われることが多いことを 想定してデフォルトでは true になっているので、普通の 画像を表示する場合は注意してください。 |
| alt | no | 代替文字 | メッセージ履歴に表示する、この画像の代替文字を指定します。 メッセージ履歴は文字情報しか表示できませんので、alt 属性に 指定された文字が代わりに表示されます。 |

任意の画像をメッセージレイヤの文字位置に表示します。
　読み込み可能な形式は [image](#image) タグで表示する
ことのできる前景画像と同じです。
　通常は、普通のフォントでは含まれていないような特殊な記号を
画像として用意し、それを表示させる用途に使用します。
　記号でなく、画像を表示する場合は char 属性に false を指定してく
ださい。
　よく使う記号はマクロを組んでおくと楽かと思います。

`例:
; heart にはハートマークの画像
[macro name="heart"][graph storage="heart" alt="(は～と)"][endmacro]
; 以後、[heart] タグでハートマークを使用可能`

[ジャンル・タグ一覧に戻る](#genre)

# hact ( メッセージ履歴アクション )

メッセージ履歴操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS式 | メッセージをクリックしたときに実行する TJS 式を指定します。 |

メッセージ履歴に対するアクションを指定します。このタグと [endhact](#endhact) タグ
で囲まれた部分は、メッセージ履歴上でクリックできるようになり、クリックされた時に実行する TJS 式
を指定することができます。過去にメッセージと共に再生した声を、メッセージ履歴のクリックで
再生できるようにするなどに応用できます。

[ジャンル・タグ一覧に戻る](#genre)

# hch ( 縦中横を表示する )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| text | yes | 文字 | ここで指定した文字がそこだけ横書きで表示されます。 |
| expand | no | true または false(デフォルト) | true を指定すると、長い縦中横を描画しようとしたときに 行間を自動的に拡張します。false を指定すると、縦中横が 行からはみ出て正常に描画されない可能性がありますが、 行間はそのままになります ( 通常半角２桁ならば false で OK )。  この属性を指定しないと false であると見なされます。 |

縦中横 ( 縦書き中に算用数字２桁を書くような場合にそこだけ横書きにする書き方 ) で文字を表示します。
　現在対象となっているメッセージレイヤが縦書きモードである必要があります。

`例:
今日は平成[hch text="15"]年[hch text="12"]月[hch text="30"]日`

[ジャンル・タグ一覧に戻る](#genre)

# hidemessage ( メッセージを消す )

システム操作

メッセージレイヤを一時的に隠します。メニューから「メッセージを消す」を選んだのと
同じ動作を行います。
　クリック待ちを行った後、メッセージレイヤは表示され、
実行は継続します。

[ジャンル・タグ一覧に戻る](#genre)

# history ( メッセージ履歴の設定 )

メッセージ履歴操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| output | no | true または false | メッセージ履歴への文字情報の出力をするかどうかを指定します。  　true を指定すると、メッセージレイヤに表示した文字がメッセージ履歴に 表示されるようになります。  　シナリオを最初に実行したときは true の状態になっています。  　false を指定するとメッセージ履歴には文字情報は出力されません。 |
| enabled | no | true または false | メッセージ履歴を表示可能かどうかを指定します。  　true を指定すると表示可能に、false を指定すると表示不可能になります。  　ユーザーにメッセージ履歴を表示させたくない場合に false にしてください。 |

メッセージ履歴の機能に関する設定を行います。

[ジャンル・タグ一覧に戻る](#genre)

# hr ( メッセージ履歴の改行/改ページ )

メッセージ履歴操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| repage | no | true または false(デフォルト) | 改ページを行うかどうかを指定します。  　true を指定すると改行ではなく改ページが行われます。false を指定すると 改行が行われます。  　この属性を省略すると false が指定されたと見なされます。  　改ページは、Config.tjs のメッセージ履歴の設定で everypage が true に なってないと動作しません。 |

メッセージ履歴を改行または改ページします。

[ジャンル・タグ一覧に戻る](#genre)

# if ( 条件によりシナリオを実行 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。この式の結果が false ( または 0 な らば、elsif・else・endif タグまでの文章やタグが無視されます。 |

式を評価し、その結果が true ( または 0 以外 ) ならば、
elsif・else・endif のいずれかまでにある文章やタグを実行し、
そうでない場合は無視します。
　if ～ endif の間にはラベルを挟まないでください。

`例:
; 例1
[if exp="false"]
ここは表示されない
[else]
ここは表示される
[endif]

; 例2
[if exp="false"]
ここは表示されない
[elsif exp="false"]
ここは表示されない
[else]
ここは表示される
[endif]

; 例3
[if exp="false"]
ここは表示されない
[elsif exp="true"]
ここは表示される
[else]
ここは表示されない
[endif]

; 例4
[if exp="true"]
ここは表示される
[elsif exp="true"]
ここは表示されない
[else]
ここは表示されない
[endif]`

[ジャンル・タグ一覧に戻る](#genre)

# ignore ( 条件によりシナリオを無視 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。この式の結果が true ( または 0 以外 )な らば、endignore タグまでの文章やタグが無視されます。 |

式を評価し、その結果が true ( または 0 以外 ) ならば、endignore タグまでにある文章
やタグが無視されます。
　ignore ～ endignore の間にはラベルを挟まないでください。

[ジャンル・タグ一覧に戻る](#genre)

# image ( 画像の読み込み )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | 画像ファイル名 | 読み込みたい画像を指定します。拡張子は省略可能です。  　ここで指定したファイル名 (拡張子を除く) 部分に \_m を追加 したファイルが、もしあれば、マスク画像として読み込まれます。 　また、同様に \_p を追加したファイルが、もしあれば、クリッカブル マップ用の領域画像として読み込まれます。  　マスク画像は必ず 256 色グレースケールで保存してください。  　領域画像はかならず 256 色で保存してください。  　また、拡張子が asd のファイルが存在すればアニメーション シーケンスデータとしてアニメーションの情報も読み込みまれ、 拡張子が ma のファイルが存在すれば、クリッカブルマップ用の 領域アクション定義ファイルとして読み込まれます。 |
| layer | yes | "base" または 0 以上の整数 | 画像を読み込むレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤに画像を読み込みます。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| key | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | どの色を抜き色とするかを指定します。省略すると抜き色は無効になります。   　key=0xRRGGBB という形式で 16 進数で抜き色を指定する と、RR(赤) GG(緑) BB(青)で塗られた部分を抜き色として透明にします。 たとえば、key=0xff00ff では (r,g,b)=(255,0,255) つまり真マゼンダの部 分を抜き色として透明にするという指定になります。  　ただ単に数値を指定すれば、そのパレットインデックスの数値が抜き 色となります。16色/256色の画像に対して有効です。  　key=adapt と指定すれば、自動的に抜き色が決定されます。 使用される抜き色は、画像の一番上のラインにて、一番多く使われている色です。 16色/256色の画像に対して有効です。  　マスク画像を使用する場合は、この属性は指定する必要は ありません。 |
| mode | no | "alpha"(デフォルト) または "transp" "opaque" "rect" "add" "sub" "mul" "dodge" "darken" "lighten" "screen" "psadd" "pssub" "psmul" "psscreen" "psoverlay" "pshlight" "psslight" "psdodge" "psdodge5" "psburn" "pslighten" "psdarken" "psdiff" "psdiff5" "psexcl" のいずれか | 前景レイヤの透過モードを指定します。前景レイヤ以外には 指定しないでください。  　"alpha" または "transp" を指定するとαチャネルが有効になって画像を 透過して表示することができます。"alpha" でも "transp" でも同じ意味です。  　"opaque" または "rect" を指定すると画像は透過されません (矩形で表示されます)。"opaque" でも "rect" でも同じ意味です。  　"addalpha" を指定すると、画像を透過して表示することができます。"alpha" はアルファ合成ですが、 "addalpha" は加算アルファ合成を表します。この違いについては「吉里吉里２ リファレンス」を参照してください。  　"add" を指定すると加算合成が行われます。  　"sub" を指定すると減算合成が行われます。  　"mul" を指定すると乗算合成が行われます。  　"dodge" を指定すると「覆い焼き」合成が行われます。  　"darken" を指定すると「比較(暗)」合成が行われます。  　"lighten" を指定すると「比較(明)」合成が行われます。  　"screen" を指定すると「スクリーン乗算」合成が行われます。  　"psadd" を指定すると、Photoshop互換の「覆い焼き(リニア)」合成が行われます。  　"pssub" を指定すると、Photoshop互換の「焼き込み(リニア)」合成が行われます。  　"psmul" を指定すると、Photoshop互換の「乗算」合成が行われます。  　"psscreen" を指定すると、Photoshop互換の「スクリーン」合成が行われます。  　"psoverlay" を指定すると、Photoshop互換の「オーバーレイ」合成が行われます。  　"pshlight" を指定すると、Photoshop互換の「ハードライト」合成が行われます。  　"psslight" を指定すると、Photoshop互換の「ソフトライト」合成が行われます。  　"psdodge" を指定すると、Photoshop互換の「覆い焼きカラー」合成が行われます。  　"psdodge5" を指定すると、Photoshop互換の「覆い焼きカラー」合成(Photoshop 5.x 以下と互換)が行われます。  　"psburn" を指定すると、Photoshop互換の「焼き込みカラー」合成が行われます。  　"pslighten" を指定すると、Photoshop互換の「比較(明)」合成が行われます。  　"psdarken" を指定すると、Photoshop互換の「比較(暗)」合成が行われます。  　"psdiff" を指定すると、Photoshop互換の「差の絶対値」合成が行われます。  　"psdiff5" を指定すると、Photoshop互換の「差の絶対値」合成(Photoshop 5.x 以下と互換)が行われます。  　"psexcl" を指定すると、Photoshop互換の「除外」合成が行われます。  　透明度情報を持たない画像を指定する場合は "opaque" に指定する方が 負荷が軽くて済みます。    　省略すると "alpha" であるとみなされます。例外的に、 TLG5/6 画像の場合は、画像中に透過モードを表す情報が埋め込まれています。この場合は、この属性を 省略すると、その画像が情報として持っている透過モードに従って表示されます。 |
| grayscale | no | true または false | 画像をグレースケールにするかどうかを指定します。 grayscale=true と指定すると、画像をグレースケールにします。 省略すると false であると見なされます。 |
| rgamma | no | ガンマ補正値 (0.1 ～ 1.0(デフォルト) ～ 9.9) | r (赤) 、g (緑) 、 b (青) の各成分のガンマ値を指定します。 たとえば画像をセピア調にするには、 grayscale=true rgamma=1.3 ggamma=1.1 と指定します。 |
| ggamma | no | ガンマ補正値 (0.1 ～ 1.0(デフォルト) ～ 9.9) | r (赤) 、g (緑) 、 b (青) の各成分のガンマ値を指定します。 たとえば画像をセピア調にするには、 grayscale=true rgamma=1.3 ggamma=1.1 と指定します。 |
| bgamma | no | ガンマ補正値 (0.1 ～ 1.0(デフォルト) ～ 9.9) | r (赤) 、g (緑) 、 b (青) の各成分のガンマ値を指定します。 たとえば画像をセピア調にするには、 grayscale=true rgamma=1.3 ggamma=1.1 と指定します。 |
| rfloor | no | 輝度最低値 ( 0(デフォルト) ～ 255 ) | 各成分の輝度最低値を指定します。 |
| gfloor | no | 輝度最低値 ( 0(デフォルト) ～ 255 ) | 各成分の輝度最低値を指定します。 |
| bfloor | no | 輝度最低値 ( 0(デフォルト) ～ 255 ) | 各成分の輝度最低値を指定します。 |
| rceil | no | 輝度最高値 ( 0 ～ 255(デフォルト) ) | 各成分の輝度最高値を指定します。 たとえば、 rfloor=255 gfloor=255 bfloor=255 rceil=0 gceil=0 bceil=0 と 指定すると、色が反転します。 |
| gceil | no | 輝度最高値 ( 0 ～ 255(デフォルト) ) | 各成分の輝度最高値を指定します。 たとえば、 rfloor=255 gfloor=255 bfloor=255 rceil=0 gceil=0 bceil=0 と 指定すると、色が反転します。 |
| bceil | no | 輝度最高値 ( 0 ～ 255(デフォルト) ) | 各成分の輝度最高値を指定します。 たとえば、 rfloor=255 gfloor=255 bfloor=255 rceil=0 gceil=0 bceil=0 と 指定すると、色が反転します。 |
| mcolor | no | 0xRRGGBB 形式 | 色ブレンドによる色調効果において、ブレンドする色を 0xRRGGBB 形式で指定しま す。濃度は mopacity 属性で指定します。  　省略すると色ブレンドによる色調効果は行われません。 |
| mopacity | mcolor を指定した場合 | 不透明度(0 ～ 255) | 色ブレンドによる色調効果で、mcolor で指定した色をどれぐらいの不透 明度でブレンドするかを指定します。 |
| lightcolor | no | 0xAARRGGBB形式 | 光ブレンドによる色調効果の、ブレンドする色を 0xAARRGGBB 形式で指定します。 α値を含むのに注意してください。  　省略すると光ブレンドによる色調効果は行われません。この処理は mcolor 処理の後で実行されます。 |
| lighttype | lightcolor を指定した場合 | mode と同じ | 光ブレンドによる色調効果の、合成モードを指定します。 |
| shadow | no | 0xRRGGBB 形式 | レイヤの画像に影をつけます。影色を 0xRRGGBB 形式で指定します。数値省略時は 0x000000 扱いです。 shadowopacity,shadowx,shadowy,shadowblur でつける影のパラメータを指定できます。 |
| shadowopacity | no | 濃度指定(0～255) | shadowで影をつけるときの影の濃度を指定します。未指定時の値は200です。 |
| shadowx | no | ピクセル値 | shadowで影をつけるときの影のX方向のずれの量を指定します。未指定時の値は10です。 |
| shadowy | no | ピクセル値 | shadowで影をつけるときの影のY方向のずれの量を指定します。未指定時の値は10です。 |
| shadowblur | no | 数値指定(0～) | shadowで影をつけるときの影のぼかし具合を指定します。未指定時の値は 3 です。 |
| clipleft | no | クリップ矩形左端位置(pixel単位) | 画像クリップ矩形の左端位置を指定し ます。clipleft, cliptop, clipwidth, clipheight で矩形を指定 すると、storage 属性で指定された画像のその矩形のみが切り取られ、 指定されたレイヤの画像になります。画像の一部だけを切り取って 表示したいときなどに使用します。  　これらの属性を省略すると、storage 属性で指定された画像全部が レイヤの画像になります。 |
| cliptop | no | クリップ矩形上端位置(pixel単位) | 画像クリップ矩形の上端位置を指定し ます。 |
| clipwidth | no | クリップ矩形幅(pixel単位) | 画像クリップ矩形の幅を指定します。 |
| clipheight | no | クリップ矩形高さ(pixel単位) | 画像クリップ矩形の高さを指定し ます |
| flipud | no | true または false(デフォルト) | 画像の上下反転を行いたい場合に true を指定します。 |
| fliplr | no | true または false(デフォルト) | 画像の左右反転を行いたい場合に true を指定します。 |
| visible | no | true または false | layer 属性で指定したレイヤを表示するか、しないかを指定 します。visible=true と 指定すれば、レイヤは表示状態になります。visible=false と指定すれば、 非表示状態になります。省略すると表示状態は変わりませ ん。layer=base を指定した場合はこの属性は指定しないでください。 |
| left | no | 左端位置(pixel単位) | layer 属性で指定したレイヤの左端位置を指定します。 省略すると、画像読み込み前の位置を保持します。layer=base と指定した場合は この属性は指定しないでください。 |
| top | no | 上端位置(pixel単位) | layer 属性で指定したレイヤの上端位置を指定します。 省略すると、画像読み込み前の位置を保持します。layer=base と指定した場合は この属性は指定しないでください。 |
| pos | no | left または left\_center または center または right\_center または right | レイヤ位置を自動的に決定します。前景レイヤに対して使います。  　横方向の位置は、この属性で指定した left ( 左端 ) 、left\_center ( 左より )、center ( 中央 )、 right\_center ( 右より )、right ( 右端 ) の位置に表示されます。各横方向の座標の中心 位置は Config.tjs で指定することができます。  　left, left\_center, center, right\_center, right の代わりに、それぞれ l, lc, c, rc, r を 指定することもできます ( 動作は同じです )。  　縦方向の位置については、レイヤの下端は画面の下端に合わせて ( 下側に 詰められて ) 表示されます。  　この属性を指定した場合は left 属性や top 属性は無視されます。  　layer=base と指定した場合にはこの属性は指定しないでください。 |
| opacity | no | 不透明度 ( 0 (全くの透明) ～ 255 (全くの不透明 ) ) | layer 属性で指定したレイヤの不透明度を指定します。  　デフォルトで 255 (全くの不透明) です。つまり、この属性を指定しないで 画像を読み込むと、そのレイヤの opacity が 255 以外でも、255 に設定し なおされます。  　128 を指定すると半分程度の透明度になり、透けて表示されます。  　opacity=0 としてもレイヤを見えなくすることが出来ますが、全くの透明に なっただけで非表示になるわけではありません。  　この属性を設定してもレイヤの画像自体が変化するわけではありません。 変化するのは表示の状態です。 |
| mapimage | no | 画像ファイル名 | クリッカブルマップに用いる領域画像を指定します。  　ここで指定を行わなくても、storage 属性で指定したファイル名 (拡張子を除く) 部分に \_p を追加したファイルが もしあれば自動的に領域画像として読み込まれますが、 別のファイルを代わりに読み込みたい場合にこの属性を用います。 |
| mapaction | no | 領域アクション定義ファイル名 | クリッカブルマップに用いる領域アクション定義ファイルを指定します。  　ここで指定しなくても、storage 属性で指定したファイル名と同名で拡張子が ma の ファイルがあれば自動的に涼気アクション定義ファイルとして読み込まれますが、 別のファイルを代わりに読み込みたい場合にこの属性を用います。  　拡張子 ( 通常は .ma ) は省略できませんので拡張子も含めて指定してください。 |
| index | no | 正の整数 | 背景レイヤには指定しないでください。  　重ね合わせ順序を指定します。値が大きいほど手前に表示されます。  　標準では、前景レイヤ 0 が 1000、前景レイヤ 1 が 2000 ( 以降 1000 ずつ増える )、 メッセージレイヤ 0 が 1000000、メッセージレイヤ 1 が 1001000 ( 以降 1000 ずつ増える )、 　メッセージ履歴を表示するためのレイヤが 2000000 となっています。  　背景レイヤの重ね合わせ順序は変更することはできません。  　[laycount](#laycount) タグを実行すると、この重ね合わせ順序は 標準の状態に戻されてしまう場合があるので注意してください。 |

画像を読み込みます。img でも image でも同じ意味です。多くの属性がありま
すが、必須なのは storage と layer のみです。
　前景レイヤは KAG 初期状態では非表示状態なので、visible=true とすれば
表示されるようになります。

　色調補正は読み込む画像に対して、
・grayscale によるグレースケール化
・?gamma , ?floor , ?ceil によるガンマ補正
・mcolor, mopacity による色ブレンド
の順番で行われます。
　アニメーション情報の作成の方法は AnimationLayer.tjs 内を参照してください。
　クリッカブルマップの使い方については KAG システムリファレンスを参照してください。

[ジャンル・タグ一覧に戻る](#genre)

# indent ( インデントの設定 )

メッセージ操作

このタグの位置に左インデント ( 縦書きの場合は頭インデント ) を設定します。発言者インデントなどとして使うことができます。インデントを解除する場合は、改行の前に [endindent](#endindent) タグを使用します。

`例:
【あんぱん】[indent]このように発言者インデントなどとして使うことができます。[endindent]`

[ジャンル・タグ一覧に戻る](#genre)

# input ( 文字列の入力 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | 変数名 | 入力したい文字列を格納する変数を指定します。  　もし変数にすでに文字列が入っていた場合は、 その文字列がダイアログボックスの初期文字列として表示されます。  　ユーザーがダイアログボックスのキャンセルボタンや ESC キーを押したときは 変数の値は変わりません。  　変数には KAG からアクセスできるすべての変数を指定することができます。 |
| prompt | no | プロンプトとして表示する文字列 | ダイアログボックスのプロンプト ( 入力欄のすぐ上に表示される文字列 ) を 指定します。省略すると空欄になります。  　「名前を入力してください」などにします。 |
| title | no | ダイアログボックスのタイトル | ダイアログボックスのタイトルを指定します。  　省略するとタイトルは空欄になります。  　「名前の入力」などにします。 |

文字列を入力するためにダイアログボックスを開き、ユーザーに入力を求めます。
　ユーザー名の入力などに使用することができます。

`例:
[eval exp="f.username='太郎'"]
[input name=f.username prompt="名前を入力してください" title="名前の入力"]
名前は : [emb exp=f.username]`

[ジャンル・タグ一覧に戻る](#genre)

# iscript ( TJS スクリプトの記述 )

変数・TJS 操作

[iscript] のみの行と、[[endscript](#endscript)] のみの行で
囲まれた部分に TJS スクリプトを書き込むことが出来ます。
　[iscript] のみの行というのは、その行には [iscript] タグのみしか記述しては
いけないと言うことです(endscript も同様)。
　また、マクロ中にこのタグを書くことはできません。

`例:
[iscript]
kag.restoreBookMark(0); // 0 番目の栞をたどる
[endscript]`

[ジャンル・タグ一覧に戻る](#genre)

# jump ( シナリオのジャンプ )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| countpage | no | true(デフォルト) または false | 他のラベルに移行するときに、このタグのある 場所のラベルを「読んだ」とみなすかどうかを指定します。  　ジャンプする際にそのページが「読んだ」ことになっては 困る場合に false を指定します。 |

指定されたシナリオファイルの指定されたラベルにジャンプします。
　サブルーチン内でジャンプする場合は、call ～ return のバランスに注意してください。

[ジャンル・タグ一覧に戻る](#genre)

# l ( 行末クリック待ち )

メッセージ操作

行末のクリック待ちを行います。
[p](#p) タグとは、メッセージ履歴への改行の出力の違いや、
「文字表示 > ページ末まで一気に」
を使用したときの挙動の違いなどがあります。
　[current](#current) タグで裏ページのメッセージレイヤを
指定している場合はこの記号は表示されません。表示したい場合は
表ページのメッセージレイヤを指定してください。

[ジャンル・タグ一覧に戻る](#genre)

# laycount ( レイヤの数の変更 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layers | no | 0 または正の整数 | 前景レイヤの数を指定します。 |
| messages | no | 正の整数 | メッセージレイヤの数を指定します。  　0 は指定できません。 |

前景レイヤまたはメッセージレイヤの数を変更します。いずれの属性も
省略すれば設定は変更されません。
　レイヤ数に制限はありませんが、実行環境の OS やメモリによって制限
を受ける可能性があります。
　レイヤの数は必要最小限にしておくべきです。たくさんのレイヤを確保して
それを使い終わったら、なるべく必要最小限の状態に戻しておくのが良いでしょう。

[ジャンル・タグ一覧に戻る](#genre)

# layopt ( レイヤの属性 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | 0 以上の整数または message0 または message1 または message | 対象となる前景レイヤまたはメッセージレイヤを指定します。 　message とのみ指定した場合は、[current](#current) タグで指定した、現在の操作対象のメッセージレイヤが対象となります。 |
| page | no | "fore"(デフォルト) または "back" | 表(fore)画面のレイヤを対象とするか、裏(back)画面のレイヤを対象と するかを指定します。省略すると表ページであると見なされます。  　ただし、layer=message とのみ指定した場合でこの属性を省略した場合は 現在操作対象のページのメッセージレイヤが選択されます。 |
| visible | no | true または false | layer 属性で指定したレイヤを表示するか、しないかを指定 します。visible=true と 指定すれば、レイヤは表示状態になります。visible=false と指定すれば、 非表示状態になります。省略すると表示状態は変わりませ ん。 |
| left | no | 左端位置(pixel単位) | layer 属性で指定したレイヤの左端位置を指定します。 省略すると位置は変更しません。  　layer 属性に message0 や message1 を指定した場合は、むしろ [position](#position) タグで位置等を指定してください。  　ただし、position タグはメッセージレイヤをクリアしてしまいますが、 このタグではクリアしません。内容を維持したまま表示位置を変えたい場合は このタグを使います。 |
| top | no | 上端位置(pixel単位) | layer 属性で指定したレイヤの上端位置を指定します。 省略すると位置は変更しません。  　layer 属性に message0 や message1 を指定した場合は、むしろ [position](#position) タグで位置等を指定してください。  　ただし、position タグはメッセージレイヤをクリアしてしまいますが、 このタグではクリアしません。内容を維持したまま表示位置を変えたい場合は このタグを使います。 |
| opacity | no | 不透明度 ( 0 (全くの透明) ～ 255 (全くの不透明 ) ) | レイヤの不透明度を指定します。  　デフォルトで 255 (全くの不透明) です。128 を指定すると半分程度の 透明度になり、透けて表示されます。  　opacity=0 としてもレイヤを見えなくすることが出来ますが、全くの 透明になっただけで非表示になるわけではありません。  　また、この属性を設定してもレイヤの画像自体が変化するわけではありません。 たとえば opacity=128 として半透明にした後に 255 に戻しても正常に表示されます。  　メッセージレイヤに対してもこの属性を指定できます が、[position](#position) タグで指定する opacity 属性 とは意味が違います。 |
| autohide | no | true または false | 前景レイヤ以外には指定しないでください。  　[システム|メッセージを消す] メニューを選択したときにメッセージレイヤが隠れますが、 それと同時にこの前景レイヤも隠すかどうかを指定します。 |
| index | no | 正の整数 | 背景レイヤには指定しないでください。  　重ね合わせ順序を指定します。値が大きいほど手前に表示されます。  　標準では、前景レイヤ 0 が 1000、前景レイヤ 1 が 2000 ( 以降 1000 ずつ増える )、 メッセージレイヤ 0 が 1000000、メッセージレイヤ 1 が 1001000 ( 以降 1000 ずつ増える )、 　メッセージ履歴を表示するためのレイヤが 2000000 となっています。  　背景レイヤの重ね合わせ順序は変更することはできません。  　[laycount](#laycount) タグを実行すると、この重ね合わせ順序は 標準の状態に戻されてしまう場合があるので注意してください。 |

レイヤの属性を指定します。

[ジャンル・タグ一覧に戻る](#genre)

# link ( ハイパーリンク )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| exp | no | TJS 式 | クリックされたときに実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |
| color | no | 0xRRGGBB 形式 | リンクが選択されたときに出る半透明の矩形の色を指定します。 |
| hint | no | ヒントとして表示させる文字列 | リンクを選択し、マウスカーソルを静止させたときに表示される ツールチップヒントを指定します。  　省略すると表示は行われません。  　リンクの説明の補足に使えますが、 hint 属性のみを指定し、 target, storage, exp 属性は指定しないで空のリンクを作成し、 小難しい単語の説明をすることなどもできます。 |
| onenter | no | TJS 式 | リンク内にマウスカーソルが入ってきたときに実行される TJS 式を 指定します。 |
| onleave | no | TJS 式 | リンク内からマウスカーソルが出ていった時に実行される TJS 式を 指定します。 |
| countpage | no | true(デフォルト) または false | リンクを選択して他のラベルに移行するときに、このリンクのある 場所のラベルを「読んだ」とみなすかどうかを指定します。  　[s] タグを実行する前にリンクが選択されてジャンプする際に、 そのページが「読んだ」ことになっては困る場合に false を指定します。 |
| clickse | no | 効果音ファイル名 | クリックされたときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| clicksebuf | no | 効果音バッファ番号 | clickse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |
| enterse | no | 効果音ファイル名 | マウスが進入したときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| entersebuf | no | 効果音バッファ番号 | enterse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |
| leavese | no | 効果音ファイル名 | マウスが退出したときに再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| leavesebuf | no | 効果音バッファ番号 | leavese で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |

link タグと [endlink](#endlink) タグで囲まれた部分の文章を、
マウスやキーボードで選択可能にし、そこでクリックされたりキーを押されたときに、
ジャンプする先を指定できます。
exp 属性を指定すれば、リンクをクリックされたときに変数に値を代入するというよ
うな動作も行わせることができます。
　囲まれた文章は、ページをまたぐことは出来ません(行をまたぐことはできます)。
　一画面中に最大で 255 個のリンクを作成することができます。

[ジャンル・タグ一覧に戻る](#genre)

# load ( 栞の読み込み )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| place | no | 0または正の整数(0がデフォルト) | 栞の番号を指定します。省略すると 0 が指定されたと見なされます。  　どのような数値を指定してもかまいませんが、999 ～ 1999 は特別な意味を持つ 栞です。 |
| ask | no | true または false(デフォルト) | true を指定すると、栞をたどるかどうかの確認をします。false を 指定すると栞をたどるかどうかの確認はありません。この属性を省略 すると false を指定したとみなされます。  　栞をたどる確認でユーザが「いいえ」を選んだ場合、実行はそのまま 継続します。 |

非フリーセーブモードにおいて、栞から読み込みます。メニューから「栞をたどる」を選んだときと同じ動作です。

[ジャンル・タグ一覧に戻る](#genre)

# loadplugin ( プラグインの読み込み )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| module | yes | プラグインファイル名 | 読み込みたいプラグインファイル名を指定します。 |

このタグで読み込むプラグインは、
・プロジェクトフォルダ直下
・吉里吉里実行可能ファイルのあるフォルダ以下の plugin フォルダ
・吉里吉里実行可能ファイルのあるフォルダ
のいずれかに置いておく必要があります。
　module 属性で指定するプラグインの拡張子は省略できません。

[ジャンル・タグ一覧に戻る](#genre)

# locate ( 文字表示位置の指定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| x | no | 横方向位置 (pixel単位) | 文字を表示する x 座標位置を指定します。 |
| y | no | 縦方向位置 (pixel単位) | 文字を表示する y 座標位置を指定します。 |

文字表示位置を指定します。
　[position](#position) タグで指定した marginl と margint の属性の値が
実際には加算されます。
　横書きの場合は y を、縦書きの場合は x を省略することにより同じ行内での文字表示位置の
変更が可能となります。

[ジャンル・タグ一覧に戻る](#genre)

# locklink ( リンクのロック )

メッセージ操作

すべてのメッセージレイヤのリンクをロックします。リンクがロックされると、
メッセージレイヤ上のリンク ( ボタン、エディット、チェックボックスも含む ) はすべて
選択や操作が不能になります。
　時間制限付きの選択肢などで、時間を経過したら選択肢を選択不能に
する場合などに使用します。
　リンクのロックは、新しい別のリンクが作成されると自動的に解除されます。
　逆の動作をする [unlocklink](#unlocklink) タグもあります。

[ジャンル・タグ一覧に戻る](#genre)

# locksnapshot ( スナップショットのロック )

栞・通過記録操作

スナップショットをロックします。栞でサムネイルを保存する
場合に画面のスナップショットを撮りますが、
スナップショットをロックすると、次に
[unlocksnapshot](#unlocksnapshot) タグでロックを解除するまで、
スナップショットをロックした時点での画像をサムネイルとして
保存するようになります。
　これを利用して、右クリックサブルーチンに入ったときに
このタグを使用すれば、右クリックサブルーチン内で栞を保存しても、
保存されるサムネイルは右クリックサブルーチンに入ったときのスナップ
ショットが使われるようになります ( ロックをしないと右クリックサブルーチンに
入っている最中のスナップショットが保存されてしまう )。
　locksnapshot タグを使ったら、かならず unlocksnapshot タグも
使用しなければなりません ( 右クリックサブルーチンに使ったならば、
右クリックサブルーチンを抜けるときには必ず unlocksnapshot タグを
実行するようにしてください )。

[ジャンル・タグ一覧に戻る](#genre)

# macro ( マクロの記述 )

マクロ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | タグ名 | タグ名を指定します。以後、この名前で新しいタグが定義され、 マクロを使用できるようになります。 |

マクロ記述を開始します。新しいタグを定義することが出来ます。
　このタグから、[endmacro](#endmacro) タグまでにある文章やタグは、
name 属性で指定されたタグとして登録され、以後使用できるようになります。
　ただし、マクロ中に [iscript](#iscript) タグを使用することはできません。
　マクロ中に書かれたタグには、特別に % を頭につけた属性の値を指定することができます。
% 以降にはマクロに渡された属性名を指定します。すると、マクロに渡された属性の値をその属性の値とすることができます。このとき、| を使って属性の省略値を指定することもできます ( 下の例参照 )。
属性名には小文字を用いてください。
　また、属性の代わりに \* を書くと、マクロに渡されたすべての属性をそのタグに渡すこと
ができます。

`例:
[macro name="newtag"][font color=0xff0000]新しいタグです[resetfont][endmacro]
[newtag]
[macro name="colortag"][font color=%iro]iro 属性付きのタグ[resetfont][endmacro]
[colortag iro=0x332211]
; ↑ colotag に渡された iro 属性の値が font タグの color 属性に渡される
[macro name="transwait"][trans *][wt][endmacro]
; ↑ この transwait に渡されたすべての属性が trans タグに渡される
[macro name="colortag"][font color=%iro|0xff0000]iro 属性付きで省略値をしていしたタグ[resetfont][endmacro]
; ↑ % の属性の値では、 | のあとに続けて、その属性の省略値を指定することができます`

[ジャンル・タグ一覧に戻る](#genre)

# mapaction ( クリッカブルマップ用領域アクション定義ファイルの指定 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | 対象とするレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| storage | yes | 領域アクション定義ファイル名 | 領域アクション定義ファイルを指定します。 |

指定したレイヤのクリッカブルマップの領域アクション定義に使用するファイルを指定します。
　このタグや [image](#image) タグで領域アクション定義ファイルを読み込むと
実際にクリッカブルマップが使用可能になります。[mapdisable](#mapdisable) タグ
でクリッカブルマップを使用不可能にすることができます。
　詳しくは KAG System リファレンスをご覧ください。

[ジャンル・タグ一覧に戻る](#genre)

# mapdisable ( クリッカブルマップの無効化 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | 対象とするレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |

指定したレイヤのクリッカブルマップを無効にします。
　以降は [image](#image) タグや  [mapaction](#mapaction)  タグを
使って領域アクション定義ファイルを読み込まなければクリッカブルマップは使用できません。

[ジャンル・タグ一覧に戻る](#genre)

# mapimage ( クリッカブルマップ用領域画像の指定 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | 対象とするレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| storage | yes | 画像ファイル名 | クリッカブルマップの領域画像として用いるファイルを指定します。 　ファイルは 256 色で保存されている必要があります。 |

指定したレイヤのクリッカブルマップの領域画像に使用するファイルを指定します。
　[image](#image) タグや [mapaction](#mapaction) タグで
領域アクション定義ファイルを読み込まないとクリッカブルマップは使用できません。
　詳しくは KAG System リファレンスをご覧ください。

[ジャンル・タグ一覧に戻る](#genre)

# mappfont ( レンダリング済みフォントの割り当て )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | ファイル名 | 現在のフォントに割り当てたいレンダリング済みフォントファイル を指定します。 |

現在操作対象になっているメッセージレイヤの現在のフォントに、指定した
レンダリング済みフォントを割り当てます。このタグ以降、吉里吉里でそのフォントを
描画するときは常に指定したレンダリング済みフォントが使用されます。
　割り当てるフォントは実際に存在していなくてもかまいません。たとえば、
"ほげほげフォント" というフォントが選択されている状態で mappfont を使えば、
その "ほげほげフォント" に任意のレンダリング済みフォントを割り当てることが
できます。一つのフォント名には一つのレンダリング済みフォントしか割り当てる
ことしかできません ( たとえば、一つのフォント名に対して複数のサイズの違う
レンダリング済みフォントを割り当てるようなことはできません )。
　また、複数のレンダリング済みフォントをそれぞれ別のフォントに割り当てるこ
とができます。

[ジャンル・タグ一覧に戻る](#genre)

# move ( レイヤの自動移動 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | 0 以上の整数 また は message0 または message1 または message | 対象となるレイヤを指定します。  　0 以上の整数を指定すると前景レイヤになります。  　message0 または message1 を指定するとメッセージレイヤにな ります。単に message とのみ指定した場合は、[current](#current) タグで指定した現在の操作対象のメッセージレイヤが 対象になります。  　背景レイヤは指定しないでください。 |
| page | no | "back" または "fore" | layer 属性で指定したレイヤが、 表(fore)画面であるか、裏(back)画面であるかを指定します。 省略すると表ページであると見なされます。  　ただし、layer=message とのみ指定した場合でこの属性を省略した場合は 現在操作対象のページのメッセージレイヤが選択されます。 |
| spline | no | true または false(デフォルト) | true を指定すると、path 属性で指定した位置をＢスプラインで 曲線補間した線上をレイヤが移動するようになります。  　false を指定すると、path 属性で指定した位置を直線補間した線上を レイヤが移動します。  　true を指定した場合は path には最低 2 点を指定してください。 |
| time | yes | 時間(ms単位) | レイヤが path を指定した点から点を移動するのに必要な時間を指定します。  　そのため、移動には、通過する点間の区間の数×この属性の値の時間がかかります。  　ただし、accel 属性に 0 以外を指定した場合は 一点を通過する時間は 変化します ( 移動全体に要する時間は 通過する区間の数×この属性の値です )。 |
| delay | no | 時間(ms単位) | レイヤの自動移動が開始されるまでの時間を ms で指定します。  　省略すると 0 であるとみなされます。 |
| path | yes | "(x1,y1,opacity1) (x2,y2,opacity2) ..." | 移動位置を指定します。  　移動位置は、x(レイヤ左端位置), y(レイヤ上端位置), opacity(レイヤ濃度) を３つ づつ、カンマや空白、( ) で区切って指定します。  　これらの間を、スプライン補間または直線補間にてレイヤが移動します。  　opacity にはレイヤの表示濃度を指定します。レイヤの濃度も点から点を移動する 間に連続的に変化します。レイヤの濃度を連続的ではなく、突発的 ? に変化させたい 場合は濃度に 256 を足した数値を指定してください。  　レイヤを移動させずに表示濃度変化のみを 行う場合は、レイヤ位置にはすべて同じ位置を指定します。 |
| accel | no | -1 未満の数または 0(デフォルト) または 1 より大きい数 | 加速度的な動きを行わせるかどうかを指定します。  　0 を指定すると、最初から最後まで一定の割合で移動処理が進行し ます ( 各通過点を等間隔の時間で通過します )。省略すると 0 が指定され たと見なされます。  　-1 未満の数を指定すると、最初は早く、徐々に遅くなります。  　1 より大きい数を指定すると、最初は遅く、徐々に早くなります。  　実数を指定することもできます。 |

指定したレイヤに自動移動をさせます。
　レイヤは現在の位置・表示濃度からスタートして、path で指定された位置・表示濃度を元にして
移動したり表示濃度を変化させます。現在の位置や表示濃度から移動がスタートするので、
path 属性の最初の位置/濃度には、一番最初のレイヤの位置や表示濃度を指定する必要はありません。
( つまり一番最初の位置や表示濃度は [layopt](#layopt) タグなどで
指定する必要があります )。
　複数のレイヤに対して move タグを非同期に実行することができます。
　このタグはレイヤの自動移動の終了を待ちません。待つには [wm](#wm) タグを
指定してください。
　前景レイヤに画面よりも大きな画面を読み込み、このタグを使って移動させればスクロールの
効果を得ることができます。斜めスクロールも可能です。
　自動移動中は、メッセージレイヤへの文字描画ができなかったり、文字描画が遅くなったり
します。
　マウスのクリック等で自動移動は中断されます。中断されない
ようにするには [clickskip](#clickskip) タグでクリック
スキップを禁止してください。

`例:
[image storage=s1 layer=0 page=fore visible=true left=0 top=480 opacity=0]
[image storage=s2 layer=1 page=fore visible=true left=320 top=240 opacity=0]
[move time=4000 path="(0,240,255) (0,0,255) (0,-240,255) (0,-480,0)" layer=0]
[move time=4000 path="(320,240,0) (320,240,511) (320,240,0) (320, 240,0)" layer=1]
[wm][wm]`

[ジャンル・タグ一覧に戻る](#genre)

# nextskip ( 「次の選択肢まですすむ」の設定 )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| enabled | yes | true または false | 「次の選択肢まで進む」の機能を有効にする場合は true、無 効にする場合は false を指定します。 |

ユーザーが「次の選択肢まで進む」の機能を使用できるようにするか否かを
指定できます。
　デモシーンなどでは無効にしていたほうがいい場合があります。

[ジャンル・タグ一覧に戻る](#genre)

# nowait ( 文字表示ノーウェイト )

メッセージ操作

文字の表示速度をノーウェイトに設定します。
　このタグは、ノーウェイトに設定する前に、直前の文字表示速度を記憶します。
この記憶した文字表示速度に戻すには [endnowait](#endnowait) タグ
を使うことができます。
　このタグと endnowait タグの間には、保存可能なラベルを記述しないでください。

[ジャンル・タグ一覧に戻る](#genre)

# openvideo ( ビデオ/SWFの再生準備 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| storage | yes | ファイル名 | 再生準備するファイル名を指定します。 |

ビデオまたはSWF(Shockwave Flash)の再生の準備をします。
　一般的にビデオの再生準備には時間がかかるので、再生のタイミングを
ほかのものと同期させたい場合など、このタグを使って再生準備のみを
先に行わせることができます。
　再生準備をしたビデオやSWFを再生するには [playvideo](#playvideo) タ
グを使用します。
　このタグを使用しなくても playvideo タグで再生するファイル名を指定して
再生をさせることはできます。

[ジャンル・タグ一覧に戻る](#genre)

# p ( 改ページクリック待ち )

メッセージ操作

改ページのクリック待ちを行います。
　行末に [p] と書いた場合は、そのあとに \ があってもなくても改行
はしません( Config.tjs で global.ignoreCR を false に設定した場合 )。
　[current](#current) タグで裏ページのメッセージレイヤを
指定している場合はこの記号は表示されません。表示したい場合は
表ページのメッセージレイヤを指定してください。

[ジャンル・タグ一覧に戻る](#genre)

# pausebgm ( BGM 演奏の一時停止 )

効果音・BGM・ビデオ操作

BGM 演奏を一時停止します。Config.tjs で BGM 再生メディアに "Wave" を指定
した場合のみに有効です。
　BGM の一時停止状態は栞に保存されますが、一時停止していた場合の BGM の
再生位置の情報は保存されないので注意してください。
　一時停止した BGM を再開するには [resumebgm](#resumebgm) タグ
を使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# pausevideo ( ビデオの一時停止 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

ビデオの再生を一時停止します。

[ジャンル・タグ一覧に戻る](#genre)

# pimage ( 画像の部分追加読み込み )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | 画像ファイル名 | 追加して読み込む画像を指定します。 |
| layer | yes | "base" または 0 以上の整数 | 画像を追加して読み込むレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤに画像を読み込みます。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| key | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | storage で指定した画像の、どの色を抜き色とするかを指定します。 省略すると抜き色は無効になります。 　key=0xRRGGBB という形式で 16 進数で抜き色を指定する と、RR(赤) GG(緑) BB(青)で塗られた部分を抜き色として透明にします。 たとえば、key=0xff00ff では (r,g,b)=(255,0,255) つまり真マゼンダの部 分を抜き色として透明にするという指定になります。  　ただ単に数値を指定すれば、そのパレットインデックスの数値が抜き 色となります。16色/256色の画像に対して有効です。  　key=adapt と指定すれば、自動的に抜き色が決定されます。 使用される抜き色は、画像の一番上のラインにて、一番多く使われている色です。 16色/256色の画像に対して有効です。  　マスク画像を使用する場合は、この属性は指定する必要は ありません。 |
| dx | yes | ピクセル単位 | 重ね合わせ、あるいはコピーする先の左端 x 座標を (対象のレイヤ内の座標で)指定します。 |
| dy | yes | ピクセル単位 | 重ね合わせ、あるいはコピーする先の上端 y 座標を (対象のレイヤ内の座標で)指定します。 |
| sx | no | ピクセル単位 | 重ね合わせ、あるいはコピーする元の左端 x 座標を (追加して読み込む画像内の座標で)指定します。  　省略すると 0 であると見なされます。 |
| sy | no | ピクセル単位 | 重ね合わせ、あるいはコピーする元の上端 y 座標を (追加して読み込む画像内の座標で)指定します。  　省略すると 0 であると見なされます。 |
| sw | no | ピクセル単位 | 重ね合わせ、あるいはコピーする幅を 指定します。  　省略すると、追加して読み込む画像の幅すべてであると見なされます。 |
| sh | no | ピクセル単位 | 重ね合わせ、あるいはコピーする高さを 指定します。  　省略すると、追加して読み込む画像の高さすべてであると見なされます。 |
| mode | no | "copy"または "opaque" または "pile" (デフォルト) または "alpha" または "add" または "sub" または "mul" または "dodge" または "darken" または "lighten" または "screen" または "psadd" または "pssub" または "psmul" または "psscreen" または "psoverlay" または "pshlight" または "psslight" または "psdodge" または "psdodge5" または "psburn" または "pslighten" または "psdarken" または "psdiff" または "psdiff5" または "psexcl" | sx sy sw sh の各属性で指定した矩形領域を 重ね合わせるか、あるいは 単純にコピーするか、あるいは演算を行うかを指定します。  　"copy" または "opaque" を指定すると矩形領域は コピーされます。"copy" でも "opaque" でも同じ意味です。  　"pile" または "alpha" を指定すると、アルファ合成による重ね合わせが行われます。"pile" でも "alpha" でも同じ意味です。  　"addalpha" を指定すると、加算アルファ合成による重ね合わせが行われます。  　そのほかのモードについては [image](#image) タグの mode 属性を参照してください。  　省略すると "pile" が指定されたと見なされます。例外的に TLG5/6 画像は画像中にどの重ね合わせモードで重ね合わされるかの情報を持っています (この情報は [image](#image) タグで読み込まれる物と同一です)。この場合は、この属性が省略された場合は、その画像が情報として持っている重ね合わせモードに従います。 |
| opacity | no | 不透明度 ( 0 (全くの透明) ～ 255 (全くの不透明 ) ) | mode 属性で "pile" を指定した場合の重ね合わせの不透明度、あるいは "add" "sub" "mul" "dodge" "darken" "lighten" "screen" の いずれかを指定した場合の演算の強度を指定します。  　省略すると 255 であると見なされます。 |

指定したレイヤに画像を追加して読み込みます。
　指定したレイヤの指定した部分に、別の画像ファイルの一部分を重ね合わせたり、コピーしたりすることができます。
　いくらでも画像を追加して読み込むことができます。ただし、いくらでも、といっても、画像を追加して
読み込むとその「画像を追加して読み込んだ」という情報がどんどんと蓄積されていってしまうので注意してください。
　新しく [image](#image) タグでレイヤに画像を読み込んだり、[freeimage](#freeimage) タグで
画像を解放すると、追加して読み込んだ画像やその情報は消えます。
　たとえば、一定時間間隔でレイヤに画像を追加して読み込んでアニメーション、という用途にはこのタグではなくて
アニメーションの機能を使ったほうが良いでしょう。
　このタグは、image タグで画像を読み込んだが、その画像の一部分だけを変えたい、というときに、該当する image タグの
直後に記述する、という用途に使います。

[ジャンル・タグ一覧に戻る](#genre)

# playbgm ( BGM の演奏 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | BGM ファイル名 | 演奏する BGM ファイル名を指定します。 |
| start | no | BGM 開始位置指定 | ループチューナで指定したラベルで BGM の再生開始位置を指定します。 |
| loop | no | true(デフォルト) または false | BGM をループするかを指定します。  　true を指定するとループします。false を指定すると ループしません。  　省略すると true であると見なされます。 |

BGM を演奏します。

[ジャンル・タグ一覧に戻る](#genre)

# playse ( 効果音の再生 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 効果音を再生するバッファを指定します。一つのバッファでは 同時には一つの効果音を鳴らすことができます。  　省略すると 0 であると見なされます。 |
| storage | yes | 効果音ファイル名 | 演奏する効果音ファイル名を指定します。  　拡張子は省略可能ですが、省略した場合に自動的に探し出されるのは .wav または .ogg または .mp3 の拡張子を持つファイルだけです。 ( ただし ogg と mp3 の 再生には SDK 付属のプラグインが必要 )  そのほかのプラグインで使用可能になるそのほかの ファイル形式を指定する場合は拡張子も指定してください。 |
| start | no | SE 開始位置指定 | ループチューナで指定したラベルで SE の再生開始位置を指定します。 |
| loop | no | true または false(デフォルト) | 効果音を繰り返し再生するかどうかを指定します。  　true を指定すると繰り返し再生されます。false を 指定すると一回限りの再生となります。省略すると false であると見なされます。  　true を指定した場合は [ws](#ws) タグ で効果音再生の終了を待つことはできません。 |

効果音を再生します。
　このタグは効果音の再生の終了を待ちません。終了を待つに
は [ws](#ws) タグを使ってください。

[ジャンル・タグ一覧に戻る](#genre)

# playvideo ( ビデオ/SWFの再生 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| storage | no | ファイル名 | 再生するファイル名を指定します。  　すでに [openvideo](#openvideo) タグで 再生の準備をしていた場合はこの属性を指定する必要はありません。  　逆に、openvideo タグを使用しない場合はここでファイル名を 指定する必要があります。 |

ビデオまたはSWF(Shockwave Flash)を再生します。[video](#video) タグで指定した表示領域にて再
生します。ビデオ表示領域はデフォルトでは非表示なので、video タグで表示状態にしないと
表示されません。
　このタグはビデオの再生の終了を待ちません。待つには [wv](#wv) を使用してください。

[ジャンル・タグ一覧に戻る](#genre)

# position ( メッセージレイヤの属性 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | no | message0 または message1 または message | 対象とするメッセージレイヤを指定します。  　省略すると [current](#current) タグで指定された 現在のメッセージレイヤが選択されます。  　この属性も page 属性も省略された場合は、current タグで指定された 現在のページ・現在のメッセージレイヤが選択されます。 |
| page | no | "fore" または "back" | 対象とするページを指定します。  　この属性を省略すると [current](#current) タグで指定された 現在のページが選択されます。 |
| left | no | 左端位置 ( pixel 単位 ) | メッセージレイヤの左端位置を指定します。 |
| top | no | 上端位置 ( pixel 単位 ) | メッセージレイヤの上端位置を指定します。 |
| width | no | 幅 ( pixel 単位 ) | メッセージレイヤの幅を指定します。 |
| height | no | 高さ ( pixel 単位 ) | メッセージレイヤの高さを指定します。 |
| frame | no | フレーム画像のファイル名 | メッセージレイヤのフレーム画像として表示させる画像を指定 します。使用しない場合は "" を指定してください。"" を指定す ると、メッセージレイヤが color および opacity 属性で指定した 色、濃度で矩形で表示されます。 　ここで指定したファイル名 (拡張子を除く) 部分に \_m を追加 したファイルが、もしあれば、マスク画像として読み込まれます。 マスク画像は必ず 256 色グレースケールで保存してください。 |
| framekey | no | 0xRRGGBB 形式 または パレットインデックス番号 または "adapt" | frame 属性で指定したフレーム画像の、どの色を抜き色と するかを指定します。省略すると抜き色は無効になります。 　key=0xRRGGBB という形式で 16 進数で抜き色を指定する と、RR(赤) GG(緑) BB(青)で塗られた部分を抜き色として透明にします。 たとえば、key=0xff00ff では (r,g,b)=(255,0,255) つまり真マゼンダの部 分を抜き色として透明にするという指定になります。  　ただ単に数値を指定すれば、そのパレットインデックスの数値が抜き 色となります。16色/256色の画像に対して有効です。  　key=adapt と指定すれば、自動的に抜き色が決定されます。 使用される抜き色は、画像の一番上のラインにて、一番多く使われている色です。 16色/256色の画像に対して有効です。  　マスク画像を使用する場合は、この属性を指定する必要はありません。 |
| color | no | 0xRRGGBB 形式 | メッセージレイヤの表示色を 0xRRGGBB 形式で指定 します。 frame に "" を指定したときに有効です。 |
| opacity | no | 不透明度 ( 0 ～ 255 ) | メッセージレイヤの不透明度を 0 ～ 255 の数値で指定しま す(文字の不透明度や、レイヤ自体の不透明度ではありません)。0 で完全 に透明です。frame に "" を指定したときに有効です。 |
| marginl | no | 左余白 ( pixel 単位 ) | メッセージレイヤの左余白を指定します。 |
| margint | no | 上余白 ( pixel 単位 ) | メッセージレイヤの上余白を指定します。 |
| marginr | no | 右余白 ( pixel 単位 ) | メッセージレイヤの右余白を指定します。 |
| marginb | no | 下余白 ( pixel 単位 ) | メッセージレイヤの下余白を指定します。 |
| vertical | no | "true" または "false" | メッセージレイヤを縦書きにモードにするには "true" を指定します。 横書きにするには "false" を指定してください。 |
| draggable | no | "true" または "false" | true に設定すると、marginl, margint, marginr, marginb で指定した マージンの部分でかつ、フレーム画像の不透明度が 64 以上の箇所を、マウスで ドラッグすることによりメッセージレイヤをユーザが移動できるようになります。  　false を指定するとこの動作は行われません。 |
| visible | no | "true" または "false" | true に設定すると、メッセージレイヤが可視(表示状態)になります。  　false に設定すると、メッセージレイヤは不可視(非表示状態)になります。 |

メッセージレイヤに対する様々な属性を指定します。
　いずれの属性も、省略すれば設定は変更されません。
　marginl, margint, marginr, marginb のそれぞれの属性は、frame で指定した
フレーム画像での表示領域を指定するのにも使います。
　メッセージレイヤに対して個別に設定できます ( 裏ページ・面画面を別の
設定にすることもできます )。

[ジャンル・タグ一覧に戻る](#genre)

# preparevideo ( ビデオの再生準備 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

ビデオの再生準備を行います。
レイヤー描画モード時に未描画画像が表示されてしまうのを防ぐためにこの機能を使用してください。
このタグの直後にかならず[wp]タグを置いて準備完了を待ってください。
このタグはレイヤー描画モード時のみ有効です。

[ジャンル・タグ一覧に戻る](#genre)

# ptext ( レイヤへの文字描画 )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | 文字を描画するレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤに文字を描画します。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| x | yes | pixel単位 | 文字を描画する横位置を pixel 単位で指定します。 |
| y | yes | pixel単位 | 文字を描画する縦位置を pixel 単位で指定します。 |
| text | yes | 文字列 | 描画する文字列を指定します。 |
| vertical | no | false(デフォルト) または true | 縦書きかどうかを指定します。true を指定すると縦書きになります。 |
| angle | no | 角度の10倍 | 文字描画の角度を指定します。角度の 10 倍の値 ( 0 ～ 3600 ) で指定します。  　省略すると、横書きの場合は 0、縦書きの場合は 2700 が指定されたと見なされます。 |
| size | no | 文字サイズ(pixel単位) | 文字サイズを pixel 単位で指定します。  　この属性を省略すると 12 が選択されます。 |
| face | no | フォント名 | フォント名を指定します。  　フォント名には曖昧な指定はできません。スペース、半角／全角も正確に指定してください。  　複数のフォント名をカンマで区切って指定できます。この場合は、最初の方に書いた フォントが存在すれば、それが優先されて選択されます。  　例 : face="HG行書体,ＭＳ Ｐゴシック"  　縦書き用フォントは自動的に設定されますので、フォント名の先頭に @ マークをつける 必要はありません。  　この属性を省略すると ＭＳ Ｐゴシックが選択されます。 |
| color | no | 0xRRGGBB 形式 | 文字色を 0xRRGGBB 形式で指定します。  　省略すると 0x000000 であると見なされます。 |
| italic | no | true または false(デフォルト) | 文字を斜体にするかどうかを指定します。true を指定すると斜体になりま す。  　この属性を省略すると false であると見なされます。 |
| shadow | no | true(デフォルト) または false | 文字に影をつけるかを指定します。true を指定すると影がつきます。  　edge と shadow 両方に true を指定することはできません。 |
| edge | no | true または false(デフォルト) | 文字を袋文字 ( 縁取り文字 ) にするかを指定します。true を指定すると袋文字になります。 |
| edgecolor | no | 0xRRGGBB 形式 | 文字の袋の色を 0xRRGGBB 形式で指定します。  　省略すると 0x000000 が指定されたと見なされます。 |
| shadowcolor | no | 0xRRGGBB 形式 | 影の色を 0xRRGGBB 形式で指定します。  　省略すると 0x000000 が指定されたと見なされます。 |
| bold | no | true または false(デフォルト) | 文字を太文字にするかを指定します。 true を指定すると太文字になります。 |

指定したレイヤに文字を描画します。
　メッセージレイヤに表示するのと異なり、このタグで描画した内容は栞に記録されます (栞を読み込んでも再現されます)。
　文字はレイヤに画像を読み込むと消去されます。
　なにかの数値ステータスなどを画面上に表示し続けたい場合に便利です。

[ジャンル・タグ一覧に戻る](#genre)

# quake ( 画面を揺らす )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | 文字数または ms(ミリ秒) | ここで指定した文字数を表示するのと同じだけの時間、画面を揺らします。  　timemode 属性で ms を指定した場合はミリ秒単位で、delay を指定した場合は [delay](#delay) タグで指定した文字表速度×このタグの time 属性で 指定した時間分揺れが続きます。 |
| timemode | no | "ms" または "delay" | time 属性の単位を指定します。  　ここの設定のデフォルトは Config.tjs の defaultQuakeTimeInChUnit に 　従います。 |
| hmax | no | pixel 単位 | 揺れの横方向への最大振幅を指定します。省略すると 10 が指定されたと見なされます。 |
| vmax | no | pixel 単位 | 揺れの縦方向への最大振幅を指定します。省略すると 10 が指定されたと見なされます。 |

画面を揺らします。
　このタグは揺れの終了を待ちません。揺れの終了を待つに
は [wq](#wq) タグを使用してください。
　vmax 属性を 0 に設定すると横揺れになります。hmax 属性を 0 に設定すると縦揺れになります。

[ジャンル・タグ一覧に戻る](#genre)

# r ( 改行する )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| eol | no | true | Config.tjs の ignoreCR が false の場合、KAG は改行の際に r タグを生成しますが、この「改行の際に生成される r タグ」の場合は この属性があり、値が true になっています。シナリオ中に書かれた [r] タグの場合はこの属性はありません。  この属性はTJSスクリプト内部で改行と[r]タグを区別したい場合に 使用されますので、KAGシナリオ上でこの属性を指定する意味はありません。 |

改行します。

[ジャンル・タグ一覧に戻る](#genre)

# rclick ( 右クリックの設定 )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| call | no | true または false | true を設定すると、右クリックで storage と target 属性で指定した サブルーチンを呼び出すようになります。jump 属性とこの属性の両方に false を 指定すると、通常の 「メッセージを消す」の動作になります。  　この属性と jump 属性を同時に true にする事はできません。 |
| jump | no | true または false | true を設定すると、右クリックで storage と target 属性で指定した 場所にジャンプするようになります。call 属性とこの属性の両方に false を 指定すると、通常の「メッセージを消す」の動作になります。  　この属性と call 属性を同時に true にする事はできません。 |
| target | no | ラベル | call 属性か jump 属性に true を設定した場合、その呼び出し先/ジャンプ先のラベルを指定します。  　この属性を target="" とした場合、storage 属性で指定したファイルの先頭から 実行が始まります。 |
| storage | no | ファイル | call 属性か jump 属性に true を設定した場合、その呼び出し先/ジャンプ先のファイルを指定します。  　この属性を storage="" とした場合、右クリックがされた時点でのファイル内の ラベルが検索されます。 |
| enabled | no | true または false | true を設定すると、右クリックによりメッセージレイヤが隠されたり、 指定のルーチンが呼び出されたり、指定場所にジャンプしたりします。  　false を指定すると、これらの動作は行われません。 |
| name | no | メニュー項目名または "default" | システムメニュー内の「メッセージを消す」のメニュー項目名を指定します。  　name=default とすると、デフォルトの「メッセージを消す」になります。  　メニューホットキー ( メニュー項目内で下線のついた文字 ) を 指定するには、& に続けて文字を指定してください ( たとえば「メッセージを 消す(&S)」 )。 |

右クリックや、キーボードから ESC キーを押した時の動作を設定します。
　いずれの属性も、省略すれば設定は変更されません。
　これらの機能は、[l] [p] タグでのクリック待ち、[s] タグでの停止時にのみ
発動することができます。

`例:
@rclick call=true target="*rclick" name="右クリック用サブルーチンを呼ぶ(&S)" enabled=true

*rclick
@rclick jump=true target="*exit" name="戻る(&S)" enabled=true
@current layer=message1
@layopt layer=message1 page=fore visible=true
@er
ここは右クリックルーチン内です。
@s
*exit
@layopt layer=message1 page=fore visible=false
@current layer=message0
@rclick call=true target="*rclick" name="右クリック用サブルーチンを呼ぶ(&S)" enabled=true
@return`

[ジャンル・タグ一覧に戻る](#genre)

# record ( 通過記録を行う )

栞・通過記録操作

現在の位置で通過記録を行います。
　通過記録には、直前にある「栞を保存可能なラベル」の位置が記録され、戻るときは
そこに戻りますが、それが実際に通過記録として記録されるタイミングは、このタグを記述し
た次の「栞を保存可能なラベル」を通過したときです。

[ジャンル・タグ一覧に戻る](#genre)

# resetfont ( 文字属性をデフォルトに戻す )

メッセージ操作

[font](#font) タグで指定した文字の属性をデフォルトに戻します。
　文字属性は、メッセージレイヤごとに個別に設定できます。

[ジャンル・タグ一覧に戻る](#genre)

# resetstyle ( スタイルをデフォルトに戻す )

メッセージ操作

[style](#style) タグで指定した行のスタイルをすべてデフォルトの設定に
戻します。

[ジャンル・タグ一覧に戻る](#genre)

# resetwait ( ウェイトの初期化 )

システム操作

[wait](#wait) タグの mode=until で使用する時間原点を設定します。
　このタグと wait タグの間には栞を保存可能なラベルを書かないでください ( 途中で栞を
保存してもこの情報までは保存されないので )。

`例:
[resetwait]
[wait mode=until time=3000]
; ↑ resetwait を通過した時間から 3 秒経過するまで待つ`

[ジャンル・タグ一覧に戻る](#genre)

# resumebgm ( BGM 演奏の再開 )

効果音・BGM・ビデオ操作

[pausebgm](#pausebgm) タグ
で一時停止した BGM を再開します。

[ジャンル・タグ一覧に戻る](#genre)

# resumevideo ( ビデオ再生の再開 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

ビデオの再生を再開します。
pausevideoでの一時停止後は、resumevideoを使用して、再生を再開します。

[ジャンル・タグ一覧に戻る](#genre)

# return ( サブルーチンから戻る )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | 戻り先のシナリオファイルを指定します。storage 属性を省略して、 target 属性だけが書かれていると、現在のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | 戻り先のラベルを指定します。  　target 属性を省略して、storage 属性だけがかかれていると、 ファイルの先頭から実行されます。 |
| countpage | no | true(デフォルト) または false | 呼び出し元に戻るときに、この return タグのある 場所のラベルを「読んだ」とみなすかどうかを指定します。  　戻る際にそのページが「読んだ」ことになっては 困る場合に false を指定します。 |

サブルーチンから呼び出し元に戻ります。
　storage と target を両方とも省略すると、呼び出し元の call タグの直後に
戻ります。storage や target を指定すれば、任意の場所に戻ることができます。
　[call](#call) タグで呼び出されたサブルーチンは、
このタグで呼び出し元に戻すか、任意の場所にもどす必要があります。

[ジャンル・タグ一覧に戻る](#genre)

# rewindvideo ( ビデオの巻き戻し )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

ビデオを先頭まで巻き戻します。

[ジャンル・タグ一覧に戻る](#genre)

# ruby ( ルビ指定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| text | yes | ルビとして表示される文字 | ルビとして表示させる文字を指定します。 |

次の一文字に対するルビを指定します。
　ルビを表示させたい場合は毎回指定してください。
　複数の文字にルビを振る場合は、一文字毎にルビを指定する必要があります。

`例:
　[ruby text="かん"]漢[ruby text="じ"]字`

[ジャンル・タグ一覧に戻る](#genre)

# s ( 停止する )

システム操作

シナリオファイルの実行を停止します。
　[link](#link) タグで選択肢待ちをするときに、このタグを書きます。

[ジャンル・タグ一覧に戻る](#genre)

# save ( 栞の保存 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| place | no | 0または正の整数(0がデフォルト) | 栞の番号を指定します。省略すると 0 が指定されたと見なされます。  　どのような数値を指定してもかまいませんが、999 ～ 1999 は特別な意味を持つ 栞です。 |
| ask | no | true または false(デフォルト) | true を指定すると、栞を保存するかどうかの確認をします。false を 指定すると栞を保存するかどうかの確認はありません。この属性を省略 すると false を指定したとみなされます。 |

非フリーセーブモードにおいて、指定された栞に保存します。メニューから「栞をはさむ」を選択された場合と
同じ動作をします。

[ジャンル・タグ一覧に戻る](#genre)

# seopt ( 効果音の設定 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 設定を変更するバッファを指定します。  　省略すると 0 であると見なされます。 |
| volume | no | 音量% (0～100) | 効果音の音量を % で指定します。初期状態の KAG では 100 % です。省略すれば音量は変更されません。  　100 が上限です。音量の抑制のみをサポートします(増幅は 音源の特性上、できません)。 |
| gvolume | no | 音量% (0～100) | 効果音の大域音量を % で指定します。初期状態の KAG では 100 % です。省略すれば音量は変更されません。  　大域音量は volume 属性で指定する通常の音量とは別に、 バッファの音量を制御することができるもう一つのものです。実際に再生 される音量は、通常の音量と大域音量を掛け合わせた音量になります ( たとえば volume=50 で gvolume=75 ならば 50(%)\*75(%)=37.5(%) )  　大域音量は効果音バッファごとにシステム変数に記録され、次回起動時 にも引き継がれます ( 各栞に保存されるわけではありません )。 |
| pan | no | パン (-100～0～100) | パン (左右の音像位置) を指定します。  　-100 が完全な左、0 が中央、100 が完全な右です。 |

効果音の個々のバッファに対する設定を変更します。

[ジャンル・タグ一覧に戻る](#genre)

# setbgmlabel ( BGM のラベル通過処理の登録 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | ラベル名 | BGM 中のループチューナで指定したラベル名を指定します。 |
| storage | no | シナリオファイル名 | ラベル通過時の遷移先シナリオファイル名を指定します。 |
| target | no | ラベル名 | ラベル通過時の遷移先ラベル名を指定します。 |
| exp | no | TJS 式 | ラベル通過時に実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |

BGM のラベルを通過した際に行う処理を登録します。複数登録可能です。BGM が変更された場合はこの指定は自動的に消去されます。

[ジャンル・タグ一覧に戻る](#genre)

# setbgmstop ( BGM の停止処理の登録 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | BGM停止時の遷移先シナリオファイル名を指定します。 |
| target | no | ラベル名 | BGM停止時の遷移先ラベル名を指定します。 |
| exp | no | TJS 式 | BGM停止時に実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |

BGM が停止した際に行う処理を登録します。BGM が変更された場合はこの指定は自動的に消去されます。

[ジャンル・タグ一覧に戻る](#genre)

# showhistory ( メッセージ履歴の表示 )

メッセージ履歴操作

メッセージ履歴を表示します。
　メッセージ履歴の表示を終了すると、実行は継続します。

[ジャンル・タグ一覧に戻る](#genre)

# startanchor ( 「最初に戻る」の有効・無効 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| enabled | no | "true"(デフォルト) または "false" | "true" を指定するかこの属性を省略すると、このタグのある すぐ前のセーブ可能なラベルが「最初に戻る」の戻り先であると され、「最初に戻る」の機能が有効になります。  　"false" を指定すると「最初に戻る」の機能が無効になります。 |

Config.tjs 内で goToStartMenuItem.visible =true; と設定すると、システム|最初に戻る
メニューが表示されますが、それが選択された場合に戻る場所をこのタグで指定します。
　戻る場所を指定する場合は enabled 属性を省略するか true を指定しますが、このタグはセーブ可能なラベルの直後に書いてください。このラベルを通過しない間は、システム|最初に戻るのメニューは使用不可能になります。
　enabled 属性に false を指定すると「最初に戻る」の機能は無効になります。
　「最初に戻る」の動作は、このタグの書かれた場所のラベルの栞を読み出す動作に
似ていますが、ゲーム変数の内容は保持されたままとなります。

[ジャンル・タグ一覧に戻る](#genre)

# stopbgm ( BGM 演奏の停止 )

効果音・BGM・ビデオ操作

BGM 演奏を停止します。

[ジャンル・タグ一覧に戻る](#genre)

# stopmove ( レイヤの自動移動の停止 )

レイヤ操作

[move](#move) タグで開始した自動移動を
強制的に中止します。すべてのレイヤの自動移動が停止します。
　画像は最終位置に移動し、最終の表示濃度になります。

[ジャンル・タグ一覧に戻る](#genre)

# stopquake ( 画面揺らしの停止 )

システム操作

[quake](#quake)タグで開始した揺れを終了させます。
　quake タグの time 属性で指定した回数を待たずに揺れを終了させることができます。

[ジャンル・タグ一覧に戻る](#genre)

# stopse ( 効果音再生の停止 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 効果音を停止するバッファを指定します。  　省略すると 0 であると見なされます。 |

効果音再生を停止します。

[ジャンル・タグ一覧に戻る](#genre)

# stoptrans ( レイヤのトランジションの停止 )

レイヤ操作

[trans](#trans) タグで開始したトランジションを
強制的に中止します。すべてのレイヤのトランジションが停止します。
　画像は完全に切り替わった状態になります。

[ジャンル・タグ一覧に戻る](#genre)

# stopvideo ( ビデオ/SWF再生の停止 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |

ビデオ/SWFの再生を停止します。

[ジャンル・タグ一覧に戻る](#genre)

# store ( 栞機能の設定 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| enabled | yes | true または false | 栞機能を有効にする場合は true 、無効にする場合は false を指定 します。false を指定すると栞によるセーブ・ロードができなく なります。 |

栞機能を有効にするか、無効にするかを指定します。ユーザーにセーブ・ロード
の動作を行わせたくない場合に [store enabled=false] とします。
　[disablestore](#disablestore) の機能と違うのは、store タグは
栞をはさむ・たどるの両方の機能を恒久的に設定するのに対し、
disablestore タグはセーブ可能なラベルを通過するまでの間の一時的な
間だけ「栞をはさむ」または「たどる」の
機能を無効にするだけです。使い勝手は disablestore の方が良いでしょう。

[ジャンル・タグ一覧に戻る](#genre)

# style ( スタイルの設定 )

メッセージ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| align | no | "left"/"top" または "center" または "right"/"bottom" または "default" | 行の文字揃えを指定します。  　横書きの場合、"left" を指定すると左揃え(デフォルト)、"center" を指定すると センタリング、"right" を指定すると右揃えになります。"default" を指定すると 左揃えになります。  　縦書きの場合、"top" を指定すると上詰め(デフォルト)、"center" を指定すると センタリング、"bottom" を指定すると下詰めになります。"default" を指定すると 上詰めになります。 |
| linespacing | no | 行間 (pixel単位) | 行間を pixel 単位で指定します。一行全体の幅は、この属性で指 定した値と linesize 属性で 指定した値を足した値になります。 |
| pitch | no | 字間オフセット(pixel単位) | 字間のオフセットを pixel 単位で指定します。 　0 を指定すると、その文字のデフォルトの字間で表示されます。負の数、たと えば -1 を指定すると、その文字のデフォルトの字間 -1 のピクセル数分、文字 が詰めて表示されます。正の数を表示すると字間をあけることが出来ます。 |
| linesize | no | 予約サイズ(pixel単位) または "default" | 行の幅を指定します。  　"default" を指定すると行の幅は自動的に決定されますが、途中で文字が大きく なると、その大きい文字に合わせて文字の再配置が行われます。  　再配置を防ぐには、あらかじめこの属性で、文字の最大の大きさを指定してください。 |
| autoreturn | no | "true" または "false" または "default" | 自動改行・自動改ページを行わせるかどうかを指定します。  　"true" または "default" を指定すると自動改行・改ページを行います。  　"false" を指定すると自動改行・改ページは行われませんので、表示する 文字が長すぎてもメッセージレイヤをはみ出して描画されます。 |

行のスタイルを指定します。
　KAG ドキュメントの「文字表示の詳細」も参照してください。
　これらの属性は、[resetstyle](#resetstyle) タグや [ct](#ct) タグが
実行されると、デフォルトの値に戻ります。
　行のスタイルはメッセージレイヤごとに個別に設定できます。

[ジャンル・タグ一覧に戻る](#genre)

# tempload ( 栞のメモリ上からの読み込み )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| place | no | 0または正の整数(0がデフォルト) | 栞の番号を指定します。省略すると 0 が指定されたと見なされます。 |
| se | no | true (デフォルト) または false | 読み込むときに、効果音の情報も読み込むかを指定します。  　false を指定すると効果音の情報は読み込みません ( 現在の効果音が そのまま鳴り続けます )。 |
| bgm | no | true (デフォルト) または false | 読み込むときに、BGM の情報も読み込むかを指定します。  　false を指定すると BGM の情報は読み込みません ( 現在の BGM が そのまま演奏され続けます )。 |
| backlay | no | true または false (デフォルト) | 読み込むときに、前景レイヤの情報は読み込まずに、かつ 背景レイヤには前景レイヤの情報を読み込むかどうかを指定します。  　true を指定すると、メモリ上の「栞」では表ページとして記録されている 情報が、実際には裏ページに読み込まれ、表ページはそのままになります。 |

[tempsave](#tempsave) タグで保存したメモリ上の「栞」を
読み出します。
　ただ、通常の栞の読み出しと違うのは、保存した位置に実行が移動しないで、
そのまま実行が続行するところと、変数の内容は変化しないことです。
　メッセージレイヤも消去されません。また、se、bgm、backlay 属性に
より、ロード時の挙動を制御することができます。
　主な用途は、たとえばデモシーンなどに入るまえにいったん tempsave タグ
で状態を保存し、デモシーンが終わったところでこのタグで復帰するという
ように、いちいちすべての設定を元に戻すのが面倒なときに、一気に設定を元に
戻す用途で使います。
　rclick で指定した右クリック時のサブルーチンで一時的に情報を保存するのにも
使うことができます。

[ジャンル・タグ一覧に戻る](#genre)

# tempsave ( 栞のメモリ上への保存 )

栞・通過記録操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| place | no | 0または正の整数(0がデフォルト) | 栞の番号を指定します。省略すると 0 が指定されたと見なされます。  　指定できる数値や保存箇所の個数に制限はありませんが、 あまり大きな整数は指定しないでください。 |

メモリ上の「栞」に現在の位置での情報を挟みます。ここで保存されるのは
ファイルではなくメモリ上の栞ですので、KAG が終了しても内容は保持されませんし、
通常の「栞」とはなんの関係も持ちません。
　また、最後に通過したラベル位置での状態が保存されるのではなくて、このタグのある位置での情報が
記録されます。また、変数の内容は記録されません。
　[tempload](#tempload) タグと組み合わせて使います。

[ジャンル・タグ一覧に戻る](#genre)

# timeout ( タイムアウト待ちジャンプ )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | タイムアウト時間 | タイムアウトまでの時間を ms で指定します。 |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| exp | no | TJS 式 | タイムアウト時に実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |
| se | no | 効果音ファイル名 | タイムアウト時に再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| sebuf | no | 効果音バッファ番号 | clickse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |

現在のメッセージレイヤに対してタイムアウトを登録します。
タイムアウト待ちは s タグが実行された時点からになります。
　このタグを使う場合は、なるべく s タグですぐに選択肢待ちにしてください。

[ジャンル・タグ一覧に戻る](#genre)

# title ( タイトル指定 )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | タイトル | 表示したいタイトルを指定してください。 |

タスクバー、およびウィンドウキャプション ( タイトルバー ) に表示する文字を指
定します。
　通常はゲーム等のタイトルです。

[ジャンル・タグ一覧に戻る](#genre)

# trace ( コンソールへ値の出力 )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| exp | yes | TJS 式 | 評価する TJS 式を指定します。 |

exp で示された式を評価し、結果をコンソールに出力します。
　コンソールは Shift+F4 で表示されるほか、Config.tjs 内で logMode を設定することに
より、ファイルに記録することもできます。

`例:
[trace exp="f.test"]
; ↑ ゲーム変数 test の内容を コンソール に出力する
; コンソールには以下のように表示される ( 例 )
; 6:45:34 ▼[trace] expression="f.test" type of result=Number result=500`

[ジャンル・タグ一覧に戻る](#genre)

# trans ( レイヤのトランジション )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | no | "base"(デフォルト) または 0 以上の整数 または は message0 または message1 または message | 対象となるレイヤを指定します。  　base を指定すると 背景レイヤ になります。  　0 以上の整数を指定すると前景レイヤになります。  　message0 または message1 を指定するとメッセージレイヤにな ります。単に message とのみ指定した場合は、[current](#current) タグで指定した現在の操作対象のメッセージレイヤが 対象になります ( 裏ページ・表ページのどちらのメッセージレイヤが操 作対象であっても裏ページ→表ページへのトランジションが行われます )。  　通常は base に対してトランジションを行わせます。  　base 以外に対してトランジションを行わせる場合はかなりの 制限があります。 |
| children | no | true(デフォルト) または false | トランジションの対象に子レイヤも含めるかどうかを 指定します。true を指定すると子レイヤも含めます。 false を指定すると子レイヤは含まれません。  　layer=base と指定したときのみ使用できます。  　子レイヤには、前景レイヤとメッセージレイヤが含まれます。 |
| time | yes | 時間(ms単位) | トランジションを行っている時間を数値で指定します。 |
| method | no | "universal" (デフォルト) または "scroll" またはその他 | トランジションのタイプを指定します。  "universal" を指定すると、 rule, vague, time 属 性に従ってユニバーサルトランジションが行われます。  "crossfade" を指定すると、time 属性に従って、単純な クロスフェードが行われます。  "scroll" を指定すると、from, stay を元にしてス クロールトランジションが行われます。  　プラグインによって使用可能になるトランジションの タイプもあります。その場合は method 属性にはその トランジションの名前を指定し、また、トランジションによっては 別の属性を指定しなければならない場合があります。 |
| rule | method=universal のときのみ | ルール画像名 | ユニバーサルトランジションに用いるルール画像を指定します。 |
| vague | method=universal のときのみ | あいまい領域値 (0～) | ユニバーサルトランジションに適用する あいまい 領域値を指定します。 |
| from | method=scroll のときのみ | "left" または "top" または "right" または "bottom" | スクロールトランジションにおいて、裏ページの画像がどの 方向から現れてくるかを指定します。"left" = 左、"top"= 上、 "right" = 右、"bottom" = 下 |
| stay | method=scroll のときのみ | "stayfore" または "stayback" または "nostay"(デフォルト) | スクロールトランシジョンにおいて、表ページの画像が その場にとどまったまま、裏ページの画像が外部から スクロールしてくるか ( "stayfore" )、  　表ページの画像がスクロールして出ていく裏から、 裏ページの画像がその場にとどまったまま現れてくるか ( "stayback" )、  　または表ページの画像と裏ページの画像が連結されて 一緒に移動しながら切り替わっていくか ( "nostay" )、を 指定します。 |

指定したレイヤでトランジションを行います。
　トランジションは、常に裏ページの対象のレイヤが、表ページの対象のレイヤに
入れ替わる方向で行われます。
　トランジション後は、表ページの対象のレイヤの画像、位置、サイズ、可視・不可視
の状態は裏ページの対象のレイヤと同じになります。
　一般的に method=universal のトランジション
は、[backlay](#backlay) タグで表ページの情報を裏画
面にコピーし、裏ページに対し
て [image](#image) や [layopt](#layopt) タグで
レイヤを操作し、この trans タグを layer=base children=true で使用し、
[wt](#wt) タグでトランジションの終了を待ちます。
　[macro](#macro) タグでこの一連の操作をマクロ化しておくと
便利かもしれません。
　トランジション中は、文字表示ができなかったり、遅くなったりします。
また、基本的に状態は「不定」なので、位置移動や表示・非表示の変更は
トランジションの終了を待ってからにしてください。
　通常は背景レイヤに対してトランジションを行わせますが、特殊な用途
に使用する目的で前景レイヤやメッセージレイヤに対して個別にトランジシ
ョンを
行わせることができます。しかし、「裏ページ・面画面のそのレイヤのサイズは
同一でなければならない」という制限があります。
　本当に特殊な用途 ( 一概に言えませんが ) に用いる以外は、layer には base
を指定してください。

　このタグは、トランジションの終了を待ちません。トランジションの終了を
待つには [wt](#wt) タグを使用してください。

`例:
[backlay]
[image storage=fg0 layer=0 page=back]
[trans method=universal time=1500 rule=trans0 vague=64]
[wt]`

[ジャンル・タグ一覧に戻る](#genre)

# unlocklink ( リンクのロックの解除 )

メッセージ操作

すべてのメッセージレイヤのリンクのロックを解除します。
　リンクやボタンは、一回選択されると、再び新しいリンクやボタンが作成されるまで
選択不能になります ( エディットやチェックボックスも操作不能になります ) が、
それを強制的に再び選択可能にするためにこのタグがあります。
　逆の動作をする [locklink](#locklink) タグもあります。

[ジャンル・タグ一覧に戻る](#genre)

# unlocksnapshot ( スナップショットのロックの解除 )

栞・通過記録操作

[locksnapshot](#locksnapshot) で
ロックしたスナップショットのロックを解除します。

[ジャンル・タグ一覧に戻る](#genre)

# video ( ビデオ/SWF表示領域の属性を指定 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| visible | no | true または false | ビデオ/SWF の表示領域を表示するか ( true の場合 )、非表示にする か ( false の場合 ) を指定します。 非表示でもビデオ/SWFは再生できます ( 当然表示されません )。 |
| left | no | 左端位置 ( pixel 単位 ) | 表示領域の左端位置を指定します。 |
| top | no | 上端位置 ( pixel 単位 ) | 表示領域の上端位置を指定します。 |
| width | no | 幅 ( pixel 単位 ) | 表示領域の幅を指定します。現バージョンではレイヤ描画モードでは指定は無視されます。 |
| height | no | 高さ ( pixel 単位 ) | 表示領域の高さを指定します。現バージョンではレイヤ描画モードでは指定は無視されます。 |
| loop | no | true または false | ループを行いたい場合は true を指定します。 |
| position | no | 時間 ( ms 単位 ) | 指定した時間までビデオの再生位置を移動したい場合に指定します。 |
| frame | no | フレーム番号 | 指定した位置までビデオの再生位置を移動したい場合に指定します。  　position属性と違い、この属性ではフレーム単位で指定することができます。 |
| mode | no | "overlay" または "layer" | ムービーの描画モードを指定します。  　"overlay" を指定するとオーバーレイモードで再生できます。オーバーレイモードではビデオは他のレイヤより奥になることはできませんが、再生負荷を軽くすることができます。  　"layer" を指定すると、レイヤ描画モードで再生できます。レイヤ描画モードでは、ビデオの画像をレイヤに表示できますが、再生負荷は "overlay" よりも高くなります。表示するレイヤは [videolayer](#videolayer) タグで設定します。 |
| playrate | no | 再生速度(0.0より大きい値) | メディアの再生速度を設定します。  　設定可能値はDirectShowのフィルタによって決まります。  　参考 : 音声付のMPEGファイルの場合、0.0より大きい値から2.0までの値が設定可能です。音声なしのMPEGファイルの場合、0.0より大きい値からdoubleの範囲内(たぶん)で設定可能ですが、実際の再生速度は処理速度によって上限が決まります。 |
| volume | no | 音量% (0～100) | 音量を % で指定します。 　100 が上限です。音量の抑制のみをサポートします(増幅は 音源の特性上、できません)。 |
| pan | no | パン (-100～0～100) | パン (左右の音像位置) を指定します。  　-100 が完全な左、0 が中央、100 が完全な右です。  　真中の値は 0 で、これは両方のチャンネルがフルボリュームであることを意味しています。  　 一方のチャンネルが減衰されても、もう一方のチャンネルはフル ボリュームのままです。 |
| audiostreamnum | no | 音声ストリーム番号(0～) | 指定した音声ストリーム番号を有効にします。 |

ビデオ/SWF表示領域の属性を指定します。
　ビデオ/SWF表示領域はデフォルトで非表示なので、このタグで表示状態にしないと表示されません。
　オーバーレイモードで表示される領域はレイヤではありません。すべてのレイヤよりも手前に表示されます。
　現バージョンではSWFはレイヤ描画モードによる再生はできません。

[ジャンル・タグ一覧に戻る](#genre)

# videoevent ( ピリオドイベントの発生 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| frame | yes | フレーム番号 | ピリオドイベントを発生させるフレーム番号を指定します。 |

指定したフレームでピリオドイベントを発生させることができます。
　ピリオドイベントは、[wp](#wp)タグで待つことができます。

[ジャンル・タグ一覧に戻る](#genre)

# videolayer ( ビデオレイヤ設定 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| channel | yes | 1 または 2 | レイヤ描画モードでは、同時に二つのチャンネルでビデオを再生できます。  　slot属性は、同時に異なるビデオを再生したいときのためにあり、channel属性は、同じビデオを２つのレイヤ(たとえば、表レイヤと裏レイヤ) で再生したいときのためにあります。  　この属性では、そのどちらのチャンネルに対してのレイヤを設定するかを指定します。 |
| page | yes | "fore" または "back" | 表ページ("fore")か、裏ページ("back")かを指定します。 |
| layer | yes | レイヤ番号(0～) | 表示したいレイヤ番号を指定します。 |

レイヤー描画モード時に、ビデオの画像を表示させたいレイヤを指定します。レイヤサイズは、ビデオのサイズに自動的に変更されます。
　この設定を解除するには[clearvideolayer](#clearvideolayer)タグを使います。

[ジャンル・タグ一覧に戻る](#genre)

# videosegloop ( ビデオのセグメントループ再生 )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| start | yes | フレーム番号 | ループの始点を指定します。 |
| end | yes | フレーム番号 | ループの終点を指定します。 |

start 属性と end 属性で示した区間内でループ再生を行います。
このタグはレイヤー描画モード時のみ有効です。

[ジャンル・タグ一覧に戻る](#genre)

# wa ( アニメーションの停止待ち )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| layer | yes | "base" または 0 以上の整数 | アニメーションの停止を待つするレイヤを指定します。  "base" を指定すると 背景レイヤ、 0 以上の整数を指定する と、対応する前景レイヤを表します。 　指定したレイヤには、アニメーション情報が読み込まれていないとなりません。 |
| page | no | "back" または "fore" | 表(fore)画面を対象とするか、裏(back)画面を対象とするかを指定します。 省略すると表ページであると見なされます。 |
| seg | yes | 0 または正の整数 | この属性で指定したセグメント番号のアニメーションの停止を待ちます。  　セグメント番号 0 も指定できます。 |

任意のセグメントのアニメーションの停止を待ちます。
　アニメーションが停止するためには、asd ファイル上で s タグか home タグを
通過する必要があります。

[ジャンル・タグ一覧に戻る](#genre)

# wait ( ウェイトを入れる )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | 時間(ミリ秒) | ウェイトをミリ秒で指定します。 |
| mode | no | "normal"(デフォルト) または "until" | ウェイトの方式を指定します。  　"normal" を指定するか、この属性を省略すると単に time で指定する時間だけ 待つことになります。  　"until" を指定すると、[resetwait](#resetwait) タグで設定した 時間原点からの経過秒を time で指定したとみなし、指定した時間までを待ちます。すでに 指定した時間を過ぎていた場合は待ちません。 |
| canskip | no | true(デフォルト) または false | このウェイトを、マウスのクリックやキーボードでスキップできるかを 指定します。false を指定すると、マウスのクリックやキーボード では、このウェイトをスキップできません。 |

ウェイトを入れます。
　現在の時間からを待つ (mode="normal") か、あるいは [resetwait](#resetwait)
タグで指定した時間原点からの時間を待つ (mode="until") ことができます。
　mode="until" の場合、すでに指定した時間を過ぎていた場合は kag.lastWaitTime という
変数に 0 が入ります。ですので、[if exp="kag.lastWaitTime != 0"] のようにして
判断すれば、「まだ指定した時間を過ぎていない場合」(多くの場合、処理が追いついている場合)
かどうかを判断できます。

[ジャンル・タグ一覧に戻る](#genre)

# waitclick ( クリックを待つ )

システム操作

クリックを待ちます。
　[l](#l) タグや [p](#p) タグと違うのは、スキップできない
ことと、クリック待ち記号が表示されないということ、待っている間は栞を挟む/たどるや、
そのほかのスキップ操作などができないなど、です。

[ジャンル・タグ一覧に戻る](#genre)

# waittrig ( トリガを待つ )

変数・TJS 操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| name | yes | トリガ名 | 待つトリガ名を指定します。 　kag オブジェクト ( MainWindow クラス ) の trigger メソッド で引数に同名のトリガ名を指定することにより、 トリガを発動し、待ち状態を解除することができます。 |
| canskip | no | true または false(デフォルト) | true を指定すると、クリックにより、待つ動作をスキップすることができます。 |
| onskip | no | TJS式 | クリックによりスキップされたときに実行する TJS式 を指定します。 |

TJS2 スクリプトが trigger メソッドを呼ぶのを待ちます。
　「トリガ」は イベント駆動型のプログラミングモデルで動作する KAG において、
シナリオ進行をいったん停止し、なんらかの処理を待つために使われる機構です。
　このタグは、TJS2 スクリプトの処理が終わるのを待つのに使います。
　たとえばトリガ名 "click" は、マウスがクリックされたときに発動するトリ
ガ ( これについては KAG 内部ですでに定義されているトリガ ) で、
[waittrig name="click"]と記述することによりマウスのクリックを待つことが
できます。

[ジャンル・タグ一覧に戻る](#genre)

# wb ( BGM フェードの終了待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| canskip | no | true または false(デフォルト) | true を指定するとクリックでフェードの終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　BGM フェードをスキップした場合は、音量は直ちにフェードの到達音量に なります。 |

BGM のフェードアウト・フェードインの終了を待ちます。

[ジャンル・タグ一覧に戻る](#genre)

# wc ( 文字数分のウェイトを入れる )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| time | yes | 文字数 | ここで指定した文字数を表示するのと同じだけの時間を待ちます。 一文字に必要な時間は [delay](#delay) タグで指定します。 |

文字数分のウェイトを入れます。

[ジャンル・タグ一覧に戻る](#genre)

# wf ( 効果音フェードの終了待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | フェードの終了を待つバッファを指定します。  　省略すると 0 であると見なされます。 |
| canskip | no | true または false(デフォルト) | true を指定するとクリックでフェード終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clipskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　効果音フェードをスキップした場合は、音量は直ちにフェードの到達音量に なります。 |

効果音のフェードアウト・フェードインの終了を待ちます。

[ジャンル・タグ一覧に戻る](#genre)

# wheel ( ホイール待ちジャンプ )

ラベル・ジャンプ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | no | シナリオファイル名 | ジャンプ先のシナリオファイルを指定します。省略すると、現在 のシナリオファイル内であると見なされます。 |
| target | no | ラベル名 | ジャンプ先のラベルを指定します。  　省略すると、ファイルの先頭から実行されます。 |
| func | no | TJS 式 | ホイール時に実行されるメソッド名を指定します。func(shift, delta, x, y) の形で呼び出されます。 省略すれば呼び出しは実行されません。storage や target が指定されていた場合、このメソッド呼び出しが が実行されてからジャンプ先に移動します。 |
| exp | no | TJS 式 | ホイール時に実行される TJS 式を指定します。省略すれば 式は実行されません。storage や target が指定されていた場合、この式 が実行されてからジャンプ先に移動します。 |
| se | no | 効果音ファイル名 | ホイール時に再生する効果音を指定します。指定しなければ 効果音は再生されません。 |
| sebuf | no | 効果音バッファ番号 | clickse で指定した効果音を鳴らす効果音バッファを指定します。 省略すると 0 であると見なされます。 |

現在のメッセージレイヤに対してクリック待ちを登録します。
リンクやボタンが無い場所をクリックした場合に反応します。
　このタグを使う場合は、なるべく s タグですぐに選択肢待ちにしてください。

[ジャンル・タグ一覧に戻る](#genre)

# wl ( BGM 再生の終了待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| canskip | no | true または false(デフォルト) | true を指定するとクリックで BGM 再生の終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　途中で再生終了待ちをスキップした場合は、BGM は直ちに停止します。 |

BGM 再生の終了を待ちます。
　BGM が繰り返し再生の場合は待ちません。

[ジャンル・タグ一覧に戻る](#genre)

# wm ( 自動移動の終了待ち )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| canskip | no | true(デフォルト) または false | true を指定するとクリックで自動移動の終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　途中で自動移動の終了待ちをスキップした場合は、直ちに最終位置に移動します。 |

自動移動の終了を待ちます。

[ジャンル・タグ一覧に戻る](#genre)

# wp ( ビデオピリオドイベント待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| for | no | "loop","period","prepare","segLoop"のいずれか | 待つイベントの種類を指定します。  　"loop"を指定すると、ループ終端を待ちます。  　"period"を指定すると、ピリオドイベントを待ちます。  　"prepare"を指定すると、preparevideoの準備完了を待ちます。  　"segLoop"を指定すると、セグメントループ終端を待ちます。 |

ピリオドイベントを待ちます。
for属性が未指定の場合、すべてのイベントを待ち、いずれかが発生すると処理を継続します。

[ジャンル・タグ一覧に戻る](#genre)

# wq ( 画面揺らしの終了待ち )

システム操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| canskip | no | true または false(デフォルト) | true を指定するとクリックでトランジションの終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　途中でトランジション終了待ちをスキップした場合は、直ちに切り替わり後の状態に 移行します。 |

[quake](#quake) タグで開始した画面揺らしの終了を待ちます。

[ジャンル・タグ一覧に戻る](#genre)

# ws ( 効果音再生の終了待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| buf | no | 効果音バッファ番号( 0(デフォルト) ～ ) | 再生終了を待つバッファを指定します。  　省略すると 0 であると見なされます。 |
| canskip | no | true または false(デフォルト) | 効果音再生をマウスのクリックでスキップできるかを 指定します。  　true を指定すると効果音再生をマウスのクリックで スキップできるようになります。  　ただし [clipskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　また、スキップされると効果音の再生も自動的に停止します。 |

効果音再生の終了を待ちます。
　効果音が繰り返し再生の場合は待ちません。

[ジャンル・タグ一覧に戻る](#genre)

# wt ( トランジションの終了待ち )

レイヤ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| canskip | no | true(デフォルト) または false | true を指定するとクリックでトランジションの終了待ちをスキップできます。  　false を指定するとスキップできません。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　途中でトランジション終了待ちをスキップした場合は、直ちに切り替わり後の状態に 移行します。 |

トランジションの終了を待ちます。

[ジャンル・タグ一覧に戻る](#genre)

# wv ( ビデオ再生の終了待ち )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| slot | no | ムービーオブジェクト番号(0～) | この操作を行うムービーオブジェクト番号を指定します。  省略すると 0 が指定されたと見なされます。  複数のムービーを同時に操作する場合は、Config.tjs の numMovies の値も、必要な個数に変更してください。 |
| canskip | no | true または false(デフォルト) | ビデオ再生をマウスのクリックでスキップできるかを 指定します。  　true を指定すると ビデオ再生をマウスのクリックで スキップできるようになります。  　ただし [clickskip](#clickskip) タグでクリックスキップが 禁止されているとこのスキップもできないので注意してください。  　また、スキップされると ビデオの再生も自動的に停止します。 |

ビデオ再生の終了や、[preparevideo](#preparevideo) タグによる再生準備の完了、[videoevent](#videoevent) タグによるピリオドイベントを待ちます。
　SWF(Sockwave Flash) の再生の終了を待つことはできません。[wait](#wait) タ
グ等で必要な時間を待つなどをして対処してください。

[ジャンル・タグ一覧に戻る](#genre)

# xchgbgm ( BGM を入れ替える )

効果音・BGM・ビデオ操作

| 属性 | 必須? | 値 | 説明 |
| --- | --- | --- | --- |
| storage | yes | BGM ファイル名 | 次に再生する BGM ファイル名または CD トラックを指定します。 |
| loop | no | true(デフォルト) または false | BGM をループするかを指定します。  　true を指定するとループします。false を指定すると ループしません。  　省略すると true であると見なされます。 |
| time | yes | フェードを行っている時間 (ms単位) | 指定した時間で現在の曲のフェードアウトが行われた後、同じ時間で 指定した曲のフェードインが行われます。 |
| overlap | no | オーバーラップを行う時間(ms単位) | overlap に時間を設定すると、その時間分、フェードアウトとフェード インの時間が重なります。省略すると 0 であると見なされます。 クロスフェードを行うときに指定します。 |
| volume | no | 音量% (0～100) | 次の曲のフェード後に到達させる BGM の音量を % で指定します。  　省略すると、次の曲の音量は現在の音量と同じになります。 |

BGM を入れ替えます。
　このタグを使う場合は、Config.tjs で doubleBuffered を true に設定してください。

[ジャンル・タグ一覧に戻る](#genre)